import { describe, it, expect } from "vitest";
import { defaultScopedTargetPermissionRolesV2, generateNAVPermissionRolesV2 } from "../composables/nav/generateNAVPermission";

describe("generateNAVPermissionRolesV2", () => {
  it("encodes expected role entries for given fund and executor", () => {
    const navExecutorAddress = "0x6B6d690F540788b87FC63BD975e6B398da775159";
    const fundAddress = "0x111f164d91e3F8169a7043f7094f44af87Fb7CA4";

    const expected0 =
      "0x7508dd9864656661756c4d616e61676572526f6c65000000000000000000000000000000000000000000000000000000111f164d91e3F8169a7043f7094f44af87Fb7CA4a61f58140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000200000000000000000000000006B6d690F540788b87FC63BD975e6B398da775159";

    const expected1 =
      "0x0c6c76b864656661756c4d616e61676572526f6c65000000000000000000000000000000000000000000000000000000111f164d91e3F8169a7043f7094f44af87Fb7CA4";

    const entries = generateNAVPermissionRolesV2(fundAddress, navExecutorAddress);
    console.log(entries);
    expect(entries).toHaveLength(2);
    expect(entries[0].toLowerCase()).toBe(expected0.toLowerCase());
    expect(entries[1].toLowerCase()).toBe(expected1.toLowerCase());
  });

  it("defaultScopedTargetPermissionRolesV2", () => {
    const expected =
      "0x7508dd9864656661756c4d616e61676572526f6c65000000000000000000000000000000000000000000000000000000111f164d91e3F8169a7043f7094f44af87Fb7CA4a9059cbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000200000000000000000000000006B6d690F540788b87FC63BD975e6B398da775159";

    const entry = defaultScopedTargetPermissionRolesV2(
      "defaulManagerRole",
      "0x111f164d91e3F8169a7043f7094f44af87Fb7CA4",
      "0xa9059cbb", // 4-byte function selector of "transfer(address,uint256)"
      "0x6b6d690f540788b87fc63bd975e6b398da775159",
      1,
    );
    console.log(entry);
    expect(entry.toLowerCase()).toBe(expected.toLowerCase());
  });
});
