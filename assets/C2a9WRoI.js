import de from"./Wy3Wx6Ei.js";import Ue from"./DXxM2RMs.js";import{d as ce,cZ as xe,c as x,w as _,a as O,p as U,b as h,l as me,F as Be,cF as I,V as oe,c8 as ue,e as c,o as l,_ as pe,u as Oe,da as Ie,c9 as Ne,r as V,h as z,ca as ye,cb as Re,f,d5 as se,d6 as ae,cB as W,cY as Y,i as j,d0 as Le,dy as re,Z as G}from"./D3HDfnxy.js";import{V as $e}from"./Cg7Ey17u.js";import qe from"./DjpIg0M2.js";import{_ as He}from"./B_WwLGbT.js";import We from"./BUlXC-6b.js";import{_ as Ge}from"./Wre7kB_p.js";import{u as Je,z as Me}from"./CL_pIM7N.js";import{I as ne}from"./cVa1OdO9.js";import{P as K,F as ie,a as Ee,S as le}from"./CO3sE27b.js";import{e as L,s as J}from"./DmMfJ0RA.js";import{V as Qe}from"./DzKiJ9cp.js";import{V as Ze}from"./CnuNmnUl.js";import{V as ze}from"./Dzq1tP6X.js";import"./QZVO053q.js";import"./DkcdTJJR.js";import"./DjkxKK4u.js";import"./D3jptR6C.js";import"./C8Z2lGgf.js";import"./CJiquoOh.js";import"./BFVrtpKD.js";import"./DPhX8wWY.js";import"./BIwcGVZU.js";import"./COuEhvrh.js";import"./DWe-URJs.js";import"./8pzO0o2T.js";import"./CH598blW.js";import"./BAneylHg.js";import"./Ce8rn2uW.js";import"./DCVy_-j1.js";import"./LimOvMzi.js";import"./BqVuMM-N.js";import"./CgAV7UTW.js";const Ye={class:"main_header__title"},je={class:"tooltip__content"},Ke={class:"tooltip__link",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},Xe={class:"buttons_container"},De=ce({__name:"ProposalHeader",props:{showPrevStep:{type:Boolean,default:!1},isLastStep:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["prev-step","handle-click"],setup(A,{emit:M}){const N=M,y=xe(),P=()=>{N("prev-step")},E=()=>{N("handle-click")};return(v,g)=>{const d=me("Icon"),Q=de,b=Ue;return l(),x(b,null,{default:_(()=>[O("div",Ye,[g[2]||(g[2]=U(" Vault Settings Proposal ")),h(Q,{location:"right","hide-after":6e3},{tooltip:_(()=>[O("div",je,[g[1]||(g[1]=U(" Update vault Settings on need! ")),O("a",Ke,[g[0]||(g[0]=U(" Learn More ")),h(d,{icon:"maki:arrow",color:"primary",width:"1rem"})])])]),default:_(()=>[h(d,{icon:"material-symbols:info-outline",class:Be("main_header__info-icon"),width:"1.5rem"})]),_:1})]),O("div",Xe,[A.showPrevStep?(l(),x(oe,{key:0,variant:"outlined",color:"secondary",onClick:P},{default:_(()=>g[3]||(g[3]=[U(" Previous ")])),_:1})):I("",!0),h(oe,{type:A.isLastStep?"submit":"button",loading:A.loading,disabled:A.isLastStep&&!c(y).isConnected,onClick:E},{default:_(()=>[U(ue(A.isLastStep?"Submit Proposal":"Next")+" ",1),A.isLastStep&&!c(y).isConnected?(l(),x($e,{key:0,"model-value":!0,activator:"parent",location:"top","onUpdate:modelValue":S=>!0},{default:_(()=>g[4]||(g[4]=[U(" Connect your wallet to create a proposal. ")])),_:1})):I("",!0)]),_:1},8,["type","loading","disabled"])])]),_:1})}}}),Ce=pe(De,[["__scopeId","data-v-3670c88e"]]),et={class:"section__title subtitle_white"},tt=["innerHTML"],ot={key:1},st={key:1,class:"fields"},at={key:1},rt={key:2},nt=ce({__name:"index",emits:["updateBreadcrumbs"],setup(A,{emit:M}){const N=M,y=Je(),P=Oe(),E=Le(),v=Ie().fund,{selectedFundSlug:g}=Ne(y),d=Object.values(K),Q=[{title:"Governance",disabled:!1,to:`/details/${g.value}/governance`},{title:"Vault Setting Proposal",disabled:!0,to:`/details/${g.value}/governance/fund-settings`}],b=V(!1),S=V(d[0]),$=V(),X=V(!1),D=Me.abi.find(e=>e.name==="updateSettings"&&e.type==="function"),q=V({}),R=V([]),k=V(!1),C=e=>e==="0"?"365":e;function ve(e,o){var s;return(s=Ee[e.key])==null?void 0:s.map(t=>{var m;if(t!=null&&t.isToggleable){const n=(m=t==null?void 0:t.fields)==null?void 0:m.map(u=>({...u,value:o[u==null?void 0:u.key],type:e.key===le.Governance?ne.Text:u.type}));return{...t,fields:n}}const a=t;return{...a,value:o[a.key],type:e.key===le.Governance?ne.Text:a.type}})}function ge(e,o){var s,t;return(t=(s=ie[e])==null?void 0:s.sections)==null?void 0:t.map(a=>({name:(a==null?void 0:a.name)??"",info:a==null?void 0:a.info,fields:ve(a,o)}))}const fe=e=>d.map(o=>{var s;return{stepName:o,stepLabel:((s=ie[o])==null?void 0:s.name)??"",sections:ge(o,e)}}),H=V((()=>{var s,t,a,m;const e=JSON.parse(JSON.stringify(v,se),ae);console.log("fundDeepCopy: ",e);const o={photoUrl:(e==null?void 0:e.photoUrl)??"",plannedSettlementPeriod:(e==null?void 0:e.plannedSettlementPeriod)??"",minLiquidAssetShare:(e==null?void 0:e.minLiquidAssetShare)??"",description:(e==null?void 0:e.description)??"",strategistName:(e==null?void 0:e.strategistName)??"",strategistUrl:(e==null?void 0:e.strategistUrl)??"",oivChatUrl:(e==null?void 0:e.oivChatUrl)??"",fundName:(e==null?void 0:e.title)??"",fundSymbol:((s=e==null?void 0:e.fundToken)==null?void 0:s.symbol)??"",baseToken:((t=e==null?void 0:e.baseToken)==null?void 0:t.address)??"",depositFee:L(e==null?void 0:e.depositFee),depositFeeRecipientAddress:(e==null?void 0:e.depositFeeAddress)??"",withdrawFee:L(e==null?void 0:e.withdrawFee),withdrawFeeRecipientAddress:(e==null?void 0:e.withdrawFeeAddress)??"",managementFee:L(e==null?void 0:e.managementFee),managementFeeRecipientAddress:(e==null?void 0:e.managementFeeAddress)??"",managementFeePeriod:C((e==null?void 0:e.managementPeriod)??""),performanceFee:L(e==null?void 0:e.performanceFee),performanceFeeRecipientAddress:(e==null?void 0:e.performanceFeeAddress)??"",performanceFeePeriod:C((e==null?void 0:e.performancePeriod)??""),hurdleRate:L(e==null?void 0:e.performaceHurdleRateBps),governanceToken:((a=e==null?void 0:e.governanceToken)==null?void 0:a.address)??"",quorum:(e==null?void 0:e.quorumPercentage)??"",votingPeriod:(e==null?void 0:e.votingPeriod)??"",votingDelay:(e==null?void 0:e.votingDelay)??"",proposalThreshold:(e==null?void 0:e.proposalThreshold)??"",lateQuorum:(e==null?void 0:e.lateQuorum)??"",proposalTitle:"",proposalDescription:"",whitelist:"",isWhitelistedDeposits:e==null?void 0:e.isWhitelistedDeposits};return R.value=(m=e==null?void 0:e.allowedDepositAddresses)==null?void 0:m.map(n=>({deleted:!1,isNew:!1,address:n})),k.value=(e==null?void 0:e.isWhitelistedDeposits)||!1,q.value=JSON.parse(JSON.stringify(o,se),ae),fe(q.value)})()),ee=e=>["votingPeriod","votingDelay","proposalThreshold","lateQuorum","quorum"].includes(e),Z=()=>H.value.map(o=>o.sections.every(s=>s.fields.every(t=>{var a,m;return ee(t.key)?!0:t!=null&&t.isToggleable?t.isToggleOn?(a=t==null?void 0:t.fields)==null?void 0:a.every(n=>{var u;return ee(n.key)?!0:((u=n==null?void 0:n.rules)==null?void 0:u.every(B=>B(n.value)===!0))??!0}):!0:((m=t==null?void 0:t.rules)==null?void 0:m.every(n=>n(t.value)===!0))??!0}))),he=z(()=>S.value!==d[0]),te=z(()=>S.value===d[d.length-1]),_e=()=>{te.value?Se():we()},Se=async()=>{var e;if((e=$.value)==null||e.validate(),X.value=Z().every(o=>o),X.value)try{b.value=!0;const o=Pe();console.log("formattedProposal: ",o);const s=ke();console.log("formattedProposalOld: ",s);const t=re(D,o),a=re(D,s),m=[v.address,v.address],n=[0,0],u=[a,t];console.log("proposal:",JSON.stringify({targetAddresses:m,gasValues:n,calldatas:u},null,2));const B=[m,n,u,JSON.stringify({title:r("proposalTitle"),description:r("proposalDescription")})];await y.fundGovernorContract.send("propose",{},...B).on("transactionHash",p=>{console.log("tx hash: "+p),P.addToast("The proposal transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",p=>{console.log("receipt: ",p),p.status?(P.successToast("Register the proposal transactions was successful. You can now vote on the proposal in the governance page."),E.push(`/details/${g.value}/governance`)):P.errorToast("The register proposal transaction has failed. Please contact the Rethink Finance support."),b.value=!1}).on("error",p=>{console.error(p),b.value=!1,P.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(o){b.value=!1,P.errorToast(o.message)}else P.warningToast("Please fill all the required fields"),console.error("invalid fields",Z())},T=z(()=>H.value.map(e=>e.sections.map(o=>o.fields.filter(s=>s.isToggleOn===!1).map(s=>s.fields?s.fields.filter(t=>!t.isToggleOn).map(t=>t.key):s.key))).flat(2).flat()),r=e=>{for(const o of H.value)for(const s of o.sections)for(const t of s.fields){if(t.key===e)return t.value;if(t.fields){for(const a of t.fields)if(a.key===e)return a.value}}},Pe=()=>{const e=v.originalFundSettings;let o=[];k.value&&(o=R.value.filter(p=>!p.deleted).map(p=>p.address));let s=k.value;o!=null&&o.length||(s=!1);const t={safe:e==null?void 0:e.safe,isExternalGovTokenInUse:e==null?void 0:e.isExternalGovTokenInUse,allowedManagers:e==null?void 0:e.allowedManagers,fundAddress:e==null?void 0:e.fundAddress,governor:e==null?void 0:e.governor,isWhitelistedDeposits:s,depositFee:T.value.includes("depositFee")?0:parseInt(J(r("depositFee"))),withdrawFee:T.value.includes("withdrawFee")?0:parseInt(J(r("withdrawFee"))),performanceFee:T.value.includes("performanceFee")?0:parseInt(J(r("performanceFee"))),managementFee:T.value.includes("managementFee")?0:parseInt(J(r("managementFee"))),performaceHurdleRateBps:0,baseToken:r("baseToken"),allowedDepositAddrs:o,governanceToken:r("governanceToken"),fundName:r("fundName"),fundSymbol:r("fundSymbol"),feeCollectors:[T.value.includes("depositFeeRecipientAddress")?G:r("depositFeeRecipientAddress"),T.value.includes("withdrawFeeRecipientAddress")?G:r("withdrawFeeRecipientAddress"),T.value.includes("managementFeeRecipientAddress")?G:r("managementFeeRecipientAddress"),T.value.includes("performanceFeeRecipientAddress")?G:r("performanceFeeRecipientAddress")]},a={photoUrl:r("photoUrl"),description:r("description"),plannedSettlementPeriod:r("plannedSettlementPeriod"),minLiquidAssetShare:r("minLiquidAssetShare")},m=r("performanceFeePeriod")==="365",u=T.value.includes("performanceFeePeriod")||m?0:parseInt(r("performanceFeePeriod"));return[t,JSON.stringify(a),0,u]},ke=()=>{const e={...v.originalFundSettings},o={photoUrl:v.photoUrl,description:v.description,plannedSettlementPeriod:v.plannedSettlementPeriod,minLiquidAssetShare:v.minLiquidAssetShare},s=v.performancePeriod,t=v.managementPeriod;return[e,JSON.stringify(o),t,s]},Te=()=>{S.value=d[d.indexOf(S.value)-1]},we=()=>{var s;if(S.value===d[d.length-1])return;(s=$.value)==null||s.validate();const e=d.indexOf(S.value),o=Z();if(!o[e]){P.warningToast("Please fill all the required fields"),console.error("invalid fields",o,d,$.value);return}S.value=d[d.indexOf(S.value)+1]};return ye(()=>{N("updateBreadcrumbs",Q)}),Re(()=>{N("updateBreadcrumbs",[])}),(e,o)=>{const s=Ce,t=me("Icon"),a=de,m=qe,n=He,u=We,B=Ge;return l(),f("div",null,[h(s,{"show-prev-step":c(he),"is-last-step":c(te),loading:c(b),onPrevStep:Te,onHandleClick:_e},null,8,["show-prev-step","is-last-step","loading"]),h(Qe,{ref_key:"form",ref:$},{default:_(()=>[(l(!0),f(W,null,Y(c(H),(p,Fe)=>(l(),f("div",{key:Fe},[(l(!0),f(W,null,Y(p.sections,(w,Ve)=>(l(),f(W,null,[p.stepName===c(S)?(l(),f("div",{key:Ve,class:"section main_card"},[O("div",et,[U(ue(w.name)+" ",1),w.info?(l(),x(a,{key:0,"hide-after":8e3},{tooltip:_(()=>[O("div",{innerHTML:w.info},null,8,tt)]),default:_(()=>[h(t,{icon:"material-symbols:info-outline",class:"section__info-icon",width:"1.5rem"})]),_:2},1024)):I("",!0),w.name==="Whitelist"?(l(),f("div",ot,[h(Ze,{modelValue:c(k),"onUpdate:modelValue":o[0]||(o[0]=i=>j(k)?k.value=i:null),color:"primary","hide-details":""},null,8,["modelValue"])])):I("",!0)]),w.info?(l(),x(m,{key:0,class:"info-box",info:w.info},null,8,["info"])):I("",!0),w.name!=="Whitelist"?(l(),f("div",st,[(l(!0),f(W,null,Y(w.fields,(i,Ae)=>(l(),x(ze,{key:Ae,cols:(i==null?void 0:i.cols)??12},{default:_(()=>[i.fields?(l(),x(u,{key:0,"is-toggle-on":i.isToggleOn,"onUpdate:isToggleOn":F=>i.isToggleOn=F,"field-group":i},{default:_(({subField:F})=>[h(n,{modelValue:F.value,"onUpdate:modelValue":be=>F.value=be,field:F,"is-disabled":!i.isToggleOn,"initial-value":p.stepName!==c(K).Details?c(q)[F.key]:void 0,"chain-id":c(v).chainId},null,8,["modelValue","onUpdate:modelValue","field","is-disabled","initial-value","chain-id"])]),_:2},1032,["is-toggle-on","onUpdate:isToggleOn","field-group"])):(l(),f("div",at,[h(n,{modelValue:i.value,"onUpdate:modelValue":F=>i.value=F,field:i,"initial-value":p.stepName!==c(K).Details?c(q)[i.key]:void 0,"chain-id":c(v).chainId},null,8,["modelValue","onUpdate:modelValue","field","initial-value","chain-id"])]))]),_:2},1032,["cols"]))),128))])):(l(),f("div",rt,[h(B,{modelValue:c(R),"onUpdate:modelValue":o[1]||(o[1]=i=>j(R)?R.value=i:null),"whitelist-enabled":c(k),"onUpdate:whitelistEnabled":o[2]||(o[2]=i=>j(k)?k.value=i:null)},null,8,["modelValue","whitelist-enabled"])]))])):I("",!0)],64))),256))]))),128))]),_:1},512)])}}}),Jt=pe(nt,[["__scopeId","data-v-7bad6efa"]]);export{Jt as default};
