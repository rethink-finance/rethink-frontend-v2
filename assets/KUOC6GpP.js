import Fe from"./B2xZHB7-.js";import{u as oe,i as Se,A as De,X as We,B as Ze,E as Je}from"./CL_pIM7N.js";import{d as G,r as I,cf as Ce,f as u,o as a,b as _,e as n,_ as Y,a as i,w as T,p as $,c as R,cF as w,c8 as v,cB as O,cY as ce,d9 as Qe,h as b,F as le,cD as Z,y as be,V as re,i as ye,c9 as $e,cZ as xe,l as Re,m as Xe,dJ as et,u as Ue,cK as tt,fK as nt,er as st,es as at,Z as Pe,P as je,ca as ot,fL as it,ct as rt,d6 as lt,f8 as dt,da as ut}from"./D3HDfnxy.js";import{p as ze}from"./C2Eccs3F.js";import{i as Ye,t as ct}from"./BjIfPQ7A.js";import{d as de,Q as ft,t as Le,r as mt,F as fe,b as Te,R as Ne,u as Ae,v as _t}from"./DmMfJ0RA.js";import pt from"./8uPjsJQY.js";import ht from"./Oh13aBS_.js";import vt from"./C3ePeIob.js";import{_ as gt}from"./CnMr6hsI.js";import{n as He,P as kt}from"./sVzXeG17.js";import Me from"./DdTq_bs2.js";import{V as ae}from"./Cg7Ey17u.js";import{_ as Oe}from"./B2hr6QJd.js";import bt from"./ERRp_wCL.js";import yt from"./D8451dTD.js";import Tt from"./DCVy_-j1.js";import wt from"./DnDfRTIK.js";import{V as Ie}from"./D3jptR6C.js";import Dt from"./BEse5ufr.js";import{u as At}from"./DkcdTJJR.js";import"./D-HsWzDh.js";import"./CJiquoOh.js";import"./cVa1OdO9.js";import"./Ce8rn2uW.js";import"./LimOvMzi.js";import"./DWe-URJs.js";import"./BFVrtpKD.js";import"./C8Z2lGgf.js";import"./DPhX8wWY.js";const Ft={class:"main_grid"},$t=G({__name:"Basics",props:{fund:{type:Object,default:()=>{}}},setup(e){const o=oe(),l=e,r=I("");return Ce(()=>{var d;return(d=l.fund)==null?void 0:d.address},async()=>{var d,t;(d=l.fund)!=null&&d.address?r.value=await o.fetchRoleModAddress((t=l.fund)==null?void 0:t.address):r.value=""},{deep:!0,immediate:!0}),(d,t)=>{var m,c,f;const s=Fe;return a(),u("div",Ft,[_(s,{title:(m=e.fund.fundToken)==null?void 0:m.symbol,subtitle:"Vault Token Symbol"},null,8,["title"]),_(s,{title:(c=e.fund.baseToken)==null?void 0:c.symbol,subtitle:"Denomination Asset"},null,8,["title"]),_(s,{title:e.fund.safeAddress,subtitle:"Safe Contract"},null,8,["title"]),_(s,{title:(f=e.fund.fundToken)==null?void 0:f.address,subtitle:"Admin Contract"},null,8,["title"]),_(s,{title:n(r),subtitle:"Roles Modifier Contract"},null,8,["title"])])}}}),St=G({name:"Deposits",props:{fund:{type:Object,default:()=>{}}},computed:{depositsTitle(){var o,l;const e=((l=(o=this.fund)==null?void 0:o.allowedDepositAddresses)==null?void 0:l.length)??0;return e===1?`${e} Address`:`${e} Addresses`},depositsBody(){var e,o;return(o=(e=this.fund)==null?void 0:e.allowedDepositAddresses)!=null&&o.length?this.fund.allowedDepositAddresses.join(`
`):"There are currently no whitelisted deposit addresses."}}}),Ct={class:"main_grid"};function xt(e,o,l,r,d,t){const s=Fe;return a(),u("div",Ct,[_(s,{title:e.depositsTitle,body:e.depositsBody},null,8,["title","body"])])}const Rt=Y(St,[["render",xt]]),Ut=G({name:"Management",props:{fund:{type:Object,default:()=>{}}},data(){return{parsedPlannedSettlement:""}},computed:{managementTitle(){var o,l;const e=((l=(o=this.fund)==null?void 0:o.allowedManagerAddresses)==null?void 0:l.length)??0;return e===1?`${e} Address`:`${e} Addresses`},managementBody(){var e,o;return(o=(e=this.fund)==null?void 0:e.allowedManagerAddresses)!=null&&o.length?this.fund.allowedManagerAddresses.join(`
`):"There are currently no addresses."}},async mounted(){var e,o;await ze((e=this.fund)==null?void 0:e.chainId,(o=this.fund)==null?void 0:o.plannedSettlementPeriod).then(l=>{this.parsedPlannedSettlement=(l==null?void 0:l.toString())||""}).catch(l=>{console.error("Error parsing planned settlement",l)})}}),Bt={class:"main_grid"};function Vt(e,o,l,r,d,t){const s=Fe;return a(),u("div",Bt,[_(s,{title:e.parsedPlannedSettlement,subtitle:"Planned Settlement Cycle"},null,8,["title"]),_(s,{title:e.fund.minLiquidAssetShare||"N/A",subtitle:"Min. Liquid Asset Share "},null,8,["title"])])}const qt=Y(Ut,[["render",Vt]]),Pt=G({name:"Fees",props:{fund:{type:Object,default:()=>{}}},methods:{formatPeriod(e){return e==0?"365":JSON.stringify(e)},formatFee(e){return e==null?"N/A":`${(Number(e)/100).toString()}%`},formatAddress(e){return!e||Ye(e)?"N/A":e}}}),Nt={class:"main_grid main_grid--full-width"};function It(e,o,l,r,d,t){var m,c,f,F,E,W,y,k,D,A;const s=Fe;return a(),u("div",Nt,[_(s,{title:e.formatFee((m=e.fund)==null?void 0:m.managementFee),subtitle:"Management Fee",title2:e.formatAddress((c=e.fund)==null?void 0:c.managementFeeAddress),subtitle2:"Distributed to",title3:e.formatPeriod((f=e.fund)==null?void 0:f.managementPeriod),subtitle3:"Fee Period (Days)",class:"main_grid__item"},null,8,["title","title2","title3"]),_(s,{title:e.formatFee((F=e.fund)==null?void 0:F.performanceFee),subtitle:"Performance Fee",title2:e.formatAddress((E=e.fund)==null?void 0:E.performanceFeeAddress),subtitle2:"Distributed to","grow-column2":!0,title3:e.formatPeriod((W=e.fund)==null?void 0:W.performancePeriod),subtitle3:"Fee Period (Days)",class:"main_grid__item"},null,8,["title","title2","title3"]),_(s,{title:e.formatFee((y=e.fund)==null?void 0:y.depositFee),subtitle:"Deposit Fee",title2:e.formatAddress((k=e.fund)==null?void 0:k.depositFeeAddress),subtitle2:"Distributed to",class:"main_grid__item"},null,8,["title","title2"]),_(s,{title:e.formatFee((D=e.fund)==null?void 0:D.withdrawFee),subtitle:"Exit Fee",title2:e.formatAddress((A=e.fund)==null?void 0:A.withdrawFeeAddress),subtitle2:"Distributed to",class:"main_grid__item"},null,8,["title","title2"])])}const Et=Y(Pt,[["render",It],["__scopeId","data-v-ba01aa8a"]]),Wt=G({name:"Governance",props:{fund:{type:Object,default:()=>{}}},computed:{governanceTokenTotalSupplyFormatted(){return de(this.fund.governanceTokenTotalSupply,this.fund.governanceToken.decimals)+" "+this.fund.governanceToken.symbol},quorumFormatted(){return`${this.fund.quorumPercentage} (${this.fund.quorumVotesFormatted} ${this.fund.governanceToken.symbol})`}}}),Mt={class:"accordion_content"},Ot={class:"main_card"},Lt={class:"main_card"},jt={class:"main_card"},zt={class:"main_card"};function Yt(e,o,l,r,d,t){const s=$t,m=Rt,c=qt,f=Et;return a(),u("div",Mt,[i("div",Ot,[o[0]||(o[0]=i("div",{class:"subtitle_steel_blue"}," Basics ",-1)),_(s,{fund:e.fund},null,8,["fund"])]),i("div",Lt,[o[1]||(o[1]=i("div",{class:"subtitle_steel_blue"}," Whitelist ",-1)),_(m,{fund:e.fund,class:"whitelist_card"},null,8,["fund"])]),i("div",jt,[o[2]||(o[2]=i("div",{class:"subtitle_steel_blue"}," Management ",-1)),_(c,{fund:e.fund},null,8,["fund"])]),i("div",zt,[o[3]||(o[3]=i("div",{class:"subtitle_steel_blue"}," Fees ",-1)),_(f,{fund:e.fund},null,8,["fund"])])])}const Ht=Y(Wt,[["render",Yt],["__scopeId","data-v-315de81a"]]),Gt={class:"overview"},Kt=G({__name:"index",props:{fund:{type:Object,default:()=>({})}},setup(e){return(o,l)=>{const r=Ht,d=Fe;return a(),u("div",Gt,[_(d,{title:"Vault Settings",class:"data_row_card"},{body:T(()=>[_(r,{fund:e.fund},null,8,["fund"])]),_:1})])}}}),Zt=Y(Kt,[["__scopeId","data-v-781db018"]]),Jt={name:"FundInfoDescription",props:{fund:{type:Object,default:()=>{}}},data(){return{maxDescriptionLength:300,showMore:!1}},computed:{buttonLinks(){return[{title:"DeBank - NAV",href:this.deBankUrl,showTooltip:!1},{title:"Safe - Custody",href:this.custodyUrl,showTooltip:!1},{isHidden:!this.fund.oivChatUrl,title:"Vault Chat",href:this.fund.oivChatUrl,showTooltip:!1}]},deBankUrl(){return`https://debank.com/profile/${this.fund.safeAddress}`},custodyUrl(){return`https://app.safe.global/balances?safe=${this.fund.chainShort}:${this.fund.safeAddress}`},isDescriptionToLong(){var e;return(e=this.fund)!=null&&e.description?this.fund.description.length>this.maxDescriptionLength:!1},fundDescriptionText(){var e,o,l,r;return(e=this.fund)!=null&&e.description?this.isDescriptionToLong&&!this.showMore?((l=(o=this.fund)==null?void 0:o.description)==null?void 0:l.slice(0,this.maxDescriptionLength))+"...":(r=this.fund)==null?void 0:r.description:""}}},Qt={class:"fund_description"},Xt={class:"fund_description__buttons"},en={class:"text-secondary"};function tn(e,o,l,r,d,t){const s=pt,m=ht,c=vt;return a(),u("div",Qt,[_(c,{title:"Information",class:"fund_description__header"},{"header-right":T(()=>[i("div",Xt,[(a(!0),u(O,null,ce(t.buttonLinks,f=>(a(),u(O,null,[f.isHidden?w("",!0):(a(),R(s,{key:f.title,title:f.title,href:f.href,"show-tooltip":f.showTooltip},null,8,["title","href","show-tooltip"]))],64))),256))])]),tools:T(()=>[i("p",en,[$(v(t.fundDescriptionText)+" ",1),t.isDescriptionToLong?(a(),R(m,{key:0,modelValue:d.showMore,"onUpdate:modelValue":o[0]||(o[0]=f=>d.showMore=f)},null,8,["modelValue"])):w("",!0)])]),_:1})])}const nn=Y(Jt,[["render",tn],["__scopeId","data-v-0df68513"]]),sn={class:"fund_insights"},an={class:"data_bar__item"},on={class:"data_bar__title"},rn={class:"data_bar__item"},ln={class:"text-white"},dn={key:0,class:"nav_usd_value ms-2"},un={class:"data_bar__item"},cn={class:"data_bar__title"},fn={class:"data_bar__item"},mn={class:"data_bar__item"},_n={class:"data_bar__title"},pn=G({__name:"Insights",props:{fund:{type:Object,default:()=>{}}},setup(e){const o=oe(),l=Se(),r=Qe(),d=b(()=>l.isActionState("fetchFundNAVDataAction",De.Loading)),t=b(()=>l.isActionState("calculateFundPerformanceMetricsAction",De.Loading)),s=b(()=>{var c,f;return l.isActionState(`fetchFundLatestSnapshot_${(c=m.fund)==null?void 0:c.chainId}_${(f=m.fund)==null?void 0:f.address}`,De.Loading)}),m=e;return(c,f)=>{const F=gt,E=kt,W=Me;return a(),u("div",sn,[_(W,{class:"data_bar"},{default:T(()=>{var y,k,D;return[i("div",an,[i("div",on,[_(F,{"chain-short":(y=m.fund)==null?void 0:y.chainShort,class:"mr-2"},null,8,["chain-short"]),$(" "+v(n(ft)(e.fund.chainName)||"N/A"),1)]),f[0]||(f[0]=i("div",{class:"data_bar__subtitle"}," Chain ",-1))]),i("div",rn,[i("div",{class:le(["data_bar__title",{"justify-center":n(d)}])},[n(s)?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):e.fund.totalSimulatedNav!=null?(a(),u(O,{key:1},[e.fund.totalSimulatedNavCalculatedAt?(a(),R(ae,{key:0,disabled:!n(r).isManageMode,location:"bottom"},{activator:T(({props:A})=>[i("div",be({class:"d-flex flex-row"},A),[i("div",ln,v(n(Le)(n(de)(e.fund.totalSimulatedNav||e.fund.lastNAVUpdateTotalNAV,e.fund.baseToken.decimals,!1,!1))+" "+e.fund.baseToken.symbol),1),e.fund.totalSimulatedNavUSD?(a(),u("div",dn," ("+v(e.fund.totalSimulatedNavUSD?"$"+n(Le)(e.fund.totalSimulatedNavUSD):"N/A")+") ",1)):w("",!0)],16)]),default:T(()=>[f[1]||(f[1]=$(" Calculated on ")),i("strong",null,v(e.fund.totalSimulatedNavCalculatedAt),1)]),_:1},8,["disabled"])):w("",!0)],64)):(a(),u(O,{key:2},[n(d)?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):w("",!0),$(" "+v(n(o).fundTotalNAVFormattedShort??"N/A"),1)],64))],2),f[2]||(f[2]=i("div",{class:"data_bar__subtitle"}," NAV ",-1))]),i("div",un,[i("div",cn,v(e.fund.inceptionDate),1),f[3]||(f[3]=i("div",{class:"data_bar__subtitle"}," Inception Date ",-1))]),i("div",fn,[i("div",{class:le(["data_bar__title",{"justify-center":n(t)}])},[n(t)?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(a(),u("div",{key:1,class:le(["data_bar__title",n(He)(((k=e.fund)==null?void 0:k.cumulativeReturnPercent)||0)])},v(n(mt)(e.fund.cumulativeReturnPercent,!0)??"N/A"),3))],2),f[4]||(f[4]=i("div",{class:"data_bar__subtitle"}," Cumulative ",-1))]),i("div",mn,[i("div",_n,[_(E,{"position-type-counts":((D=e.fund)==null?void 0:D.positionTypeCounts)??[]},null,8,["position-type-counts"])]),f[5]||(f[5]=i("div",{class:"data_bar__subtitle"}," Position Types ",-1))])]}),_:1})])}}}),hn=Y(pn,[["__scopeId","data-v-3de3ac48"]]),vn={name:"FundInfoMyDeposits",props:{fund:{type:Object,default:()=>{}}},setup(){const e=oe(),o=Se();return{fundStore:e,actionStateStore:o}},computed:{fundBaseToken(){var e;return(e=this.fundStore.fund)==null?void 0:e.baseToken},fundToken(){var e;return(e=this.fundStore.fund)==null?void 0:e.fundToken},userFundTokenBalanceFormatted(){return this.fundToken?this.fundStore.getFormattedFundTokenValue(this.fundStore.fundUserData.fundTokenBalance):"N/A"},userFundAllowanceFormatted(){return this.fundBaseToken?this.fundStore.getFormattedBaseTokenValue(this.fundStore.fundUserData.fundAllowance):"N/A"},userCurrentValueFormatted(){return this.fundBaseToken?this.fundStore.getFormattedBaseTokenValue(this.fundStore.userCurrentValue):"N/A"},isLoadingUserBalances(){return this.actionStateStore.isActionState("fetchUserBalancesAction",De.Loading)}},methods:{numberColorClass:He}},gn={class:"my_deposits"},kn={class:"data_bar__item"},bn={class:"data_bar__item"},yn={class:"data_bar__item"};function Tn(e,o,l,r,d,t){const s=Me;return a(),u("div",gn,[_(s,{title:"My Deposits"},{default:T(()=>[i("div",kn,[i("div",{class:le(["data_bar__title",{"justify-center":t.isLoadingUserBalances}])},[t.isLoadingUserBalances?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(a(),u(O,{key:1},[$(v(t.userFundTokenBalanceFormatted),1)],64))],2),o[0]||(o[0]=i("div",{class:"data_bar__subtitle"}," LP Tokens ",-1))]),i("div",bn,[i("div",{class:le(["data_bar__title",{"justify-center":t.isLoadingUserBalances}])},[t.isLoadingUserBalances?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(a(),u(O,{key:1},[$(v(t.userCurrentValueFormatted),1)],64))],2),o[1]||(o[1]=i("div",{class:"data_bar__subtitle"}," Current Value ",-1))]),i("div",yn,[i("div",{class:le(["data_bar__title",{"justify-center":t.isLoadingUserBalances}])},[t.isLoadingUserBalances?(a(),R(Z,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(a(),u(O,{key:1},[$(v(t.userFundAllowanceFormatted),1)],64))],2),o[2]||(o[2]=i("div",{class:"data_bar__subtitle"}," Allowance ",-1))])]),_:1})])}const wn=Y(vn,[["render",Tn]]),Dn={class:"fund_info_governance"},An={class:"data_bar__item"},Fn={class:"data_bar__title"},$n={class:"data_bar__item"},Sn={class:"data_bar__title"},Cn={class:"data_bar__item"},xn=G({__name:"Governance",props:{fund:{type:Object,default:()=>{}}},setup(e){const o=oe(),l=I(!1),r=e,d=b(()=>{var s;return de(o.fundUserData.governanceTokenBalance,(s=r.fund)==null?void 0:s.governanceToken.decimals,!1,!0)}),t=b(()=>{var s;return o.fundUserData.fundDelegateAddress.toLowerCase()===((s=o==null?void 0:o.activeAccountAddress)==null?void 0:s.toLowerCase())?"Myself":ct(o.fundUserData.fundDelegateAddress)});return(s,m)=>{const c=Me,f=Oe;return a(),u("div",Dn,[_(c,{title:"Governance"},{default:T(()=>[i("div",An,[i("div",Fn,[n(Ye)(n(o).fundUserData.fundDelegateAddress)?(a(),u(O,{key:0},[$(" N/A ")],64)):(a(),u(O,{key:1},[_(ae,{activator:"parent",location:"bottom"},{default:T(()=>[$(v(n(o).fundUserData.fundDelegateAddress),1)]),_:1}),$(" "+v(n(t)),1)],64))]),m[2]||(m[2]=i("div",{class:"data_bar__subtitle"}," Delegating To ",-1))]),i("div",$n,[i("div",Sn,v(n(d))+" "+v(e.fund.governanceToken.symbol),1),m[3]||(m[3]=i("div",{class:"data_bar__subtitle"}," Voting Power ",-1))]),i("div",Cn,[_(re,{class:"button",variant:"outlined",onClick:m[0]||(m[0]=F=>l.value=!0)},{default:T(()=>m[4]||(m[4]=[$(" Delegate ")])),_:1})])]),_:1}),_(f,{modelValue:n(l),"onUpdate:modelValue":m[1]||(m[1]=F=>ye(l)?l.value=F:null)},null,8,["modelValue"])])}}}),Rn=Y(xn,[["__scopeId","data-v-f128c0a9"]]),Un={name:"Info",props:{fund:{type:Object,default:()=>{}}},setup(){const{isConnected:e}=$e(xe());return{isConnected:e}}},Bn={key:0,class:"fund_info"},Vn={key:0,class:"fund_info__user_data main_grid"};function qn(e,o,l,r,d,t){var F;const s=nn,m=hn,c=wn,f=Rn;return(F=l.fund)!=null&&F.address?(a(),u("div",Bn,[_(s,{fund:l.fund},null,8,["fund"]),_(m,{fund:l.fund},null,8,["fund"]),r.isConnected?(a(),u("div",Vn,[_(c,{fund:l.fund},null,8,["fund"]),_(f,{fund:l.fund},null,8,["fund"])])):w("",!0)])):w("",!0)}const Pn=Y(Un,[["render",qn],["__scopeId","data-v-b0024938"]]),Nn=(e,o,l)=>e?`1 ${o} = ${e.toString()} ${l}`:"--",In={class:"request_deposit"},En={class:"request_deposit__token"},Wn={class:"request_deposit__token_header"},Mn={class:"request_deposit__token_data"},On={class:"request_deposit__token_col"},Ln={class:"request_deposit__token_col pa-0 request_deposit__token_col--dark text-end"},jn={class:"request_deposit__balance request_deposit__balance--row"},zn={class:"request_deposit__token"},Yn={class:"request_deposit__token_header"},Hn={class:"request_deposit__token_data"},Gn={class:"request_deposit__token_col"},Kn={class:"request_deposit__token_col text-end"},Zn={class:"request_deposit__balance"},Jn={key:0},Qn={key:1},Xn={class:"buttons_container"},es=G({__name:"BaseForm",props:{modelValue:{type:String,default:""},token0:{type:Object,default:()=>{}},token1:{type:Object,default:()=>{}},token0UserBalance:{type:BigInt,default:BigInt("0")},token1UserBalance:{type:BigInt,default:BigInt("0")},exchangeRate:{type:fe,default:fe.fromValue(0)},rules:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:o}){const l=e,r=oe(),d=o,t=b({get:()=>(l==null?void 0:l.modelValue)??"",set:y=>{d("update:modelValue",y)}}),s=y=>{t.value=y},m=[y=>{let k;try{k=Te(y||"0",l.token0.decimals)}catch{return`Make sure the value has max ${l.token0.decimals} decimals.`}return k<=0?"Value must be positive.":!0},...l.rules],c=b(()=>de(l.token0UserBalance,l.token0.decimals,!1)),f=b(()=>de(l.token1UserBalance,l.token1.decimals,!1)),F=b(()=>Nn(l.exchangeRate,l.token0.symbol,l.token1.symbol)),E=b(()=>{if(!t.value)return"0";if(!l.exchangeRate||!t.value||!l.token0.decimals)return"N/A";try{const y=l.exchangeRate.mul(fe.fromString(t.value.toString()));return Ne(y.toString())}catch(y){return console.error("error calculatedToken1Value",y),"0"}}),W=b(()=>{var D,A;if(!((D=l==null?void 0:l.token0)!=null&&D.decimals)||!((A=l==null?void 0:l.token1)!=null&&A.decimals))return"--";const k=10**-Number(l.token1.decimals-l.token0.decimals);return Ne(k.toFixed(18))});return(y,k)=>{var H,z;const D=Re("Icon"),A=yt;return a(),u("div",In,[i("div",En,[i("div",Wn,[k[2]||(k[2]=$(" Token ")),i("span",null,[_(D,{icon:"octicon:question-16",width:"1rem"}),e.token0?(a(),R(ae,{key:0,activator:"parent",location:"right"},{default:T(()=>[$(v(e.token0.symbol)+" ("+v(e.token0.address)+"). ",1)]),_:1})):w("",!0)])]),i("div",Mn,[i("div",On,v(e.token0.symbol),1),i("div",Ln,[_(A,{modelValue:n(t),"onUpdate:modelValue":k[0]||(k[0]=p=>ye(t)?t.value=p:null),rules:m,class:"request_deposit__input_amount"},null,8,["modelValue"])])]),i("div",jn,[k[3]||(k[3]=$(" Balance: ")),i("strong",{class:"set_token_value_button mx-1",onClick:k[1]||(k[1]=p=>s(n(c)))},v(n(c))+" "+v(e.token0.symbol),1)])]),i("div",zn,[i("div",Yn,[k[4]||(k[4]=$(" Token ")),i("span",null,[_(D,{icon:"octicon:question-16",width:"1rem"}),e.token1?(a(),R(ae,{key:0,activator:"parent",location:"right"},{default:T(()=>[$(v(e.token1.symbol)+" ("+v(e.token1.address)+"). ",1)]),_:1})):w("",!0)])]),i("div",Hn,[i("div",Gn,v(e.token1.symbol),1),i("div",Kn," ≈ "+v(n(E)),1)]),i("div",Zn,[i("div",null,[k[5]||(k[5]=$(" Balance: ")),i("strong",null,v(n(f))+" "+v(e.token1.symbol),1)]),n(r).fundLastNAVUpdate?(a(),u("div",Jn,[k[6]||(k[6]=$(" Based on Last NAV Update: ")),i("div",null,[i("strong",null,v(n(F)),1)])])):(a(),u("div",Qn," There was no NAV update yet: 1 "+v((H=e.token0)==null?void 0:H.symbol)+" = "+v(n(W))+" "+v((z=e.token1)==null?void 0:z.symbol),1))])]),i("div",Xn,[Xe(y.$slots,"buttons",{},void 0,!0)])])}}}),Ge=Y(es,[["__scopeId","data-v-98e749dc"]]),ts={requestDeposit:["function requestDeposit(uint256 amount)"],deposit:["function deposit()"],depositAndDelegateBySig:["function depositAndDelegateBySig(address delegatee, uint256 nonce, uint256 expiry, uint8 v, bytes32 r, bytes32 s)"],revokeDepositWithrawal:["function revokeDepositWithrawal(bool isDeposit)"],requestWithdraw:["function requestWithdraw(uint256 amount)"],withdraw:["function withdraw()"]},ns=e=>new et(ts[e]),ve=(e,o)=>ns(e).encodeFunctionData(e,o??[]),ss=(e,o=1e10,l=0,r,d,t=1,s="1")=>{const m={EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Delegation:[{name:"delegatee",type:"address"},{name:"nonce",type:"uint256"},{name:"expiry",type:"uint256"}]},c="Delegation",f={name:r,chainId:Number(t),version:s,verifyingContract:d},F={delegatee:e,nonce:Number(l),expiry:Number(o)};return{types:m,primaryType:c,domain:f,message:F}},as={class:"pending_request card_box card_box--no-padding"},os={class:"pending_request__header"},is={class:"pending_request__pending_tokens"},rs={class:"pending_request__icon_more"},ls={class:"pending_request__header pending_request__header--bg-light"},ds={class:"pending_request__available_token"},us=G({__name:"PendingRequest",props:{fundTransactionRequest:{type:Object,default:()=>{}},token0:{type:Object,default:()=>{}},token1:{type:Object,default:()=>{}},exchangeRate:{type:fe,default:fe.fromValue(0)}},emits:["cancel-request-success"],setup(e,{emit:o}){const l=o,r=oe(),d=Ue(),t=I(!1),s=()=>{t.value=!t.value},m=()=>{t.value=!1},c=e,f=b(()=>de(c.fundTransactionRequest.amount,c.token0.decimals,!1)),F=b(()=>{if(!c.exchangeRate)return 0;console.log("exchangeRate:",c.exchangeRate);const k=Ae(c.fundTransactionRequest.amount,c.token0.decimals),D=c.exchangeRate.mul(fe.fromString(k));return _t(D.toString(),3)}),E=I(!1),W=async()=>{if(!r.activeAccountAddress){d.errorToast("Connect your wallet to cancel the deposit.");return}const k=c.fundTransactionRequest.type===We.Deposit;console.log(`Cancel ${c.fundTransactionRequest.type} Request`),E.value=!0;const D=ve("revokeDepositWithrawal",[k]);try{await r.fundContract.send("fundFlowsCall",{},D).on("transactionHash",A=>{console.log("tx hash: "+A),d.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",A=>{console.log("receipt: ",A),A.status?(d.successToast(`Cancellation of a ${c.fundTransactionRequest.type} request was successful.`),l("cancel-request-success"),k?r.fundUserData.depositRequest=void 0:r.fundUserData.redemptionRequest=void 0):(r.fetchUserFundDepositRedemptionRequests(),d.errorToast("Your deposit request has failed. Please contact the Rethink Finance support.")),E.value=!1,m()}).on("error",A=>{console.error(A),d.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(A){y(A)}},y=(k,D=!0)=>{E.value=!1,[4001,100].includes(k==null?void 0:k.code)?d.addToast("Transaction was rejected."):(d.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(k),D&&r.fetchUserFundDepositRedemptionRequests())};return(k,D)=>{var H,z,p;const A=Re("Icon");return a(),u("div",as,[i("div",os,[i("div",is,[$(" Pending "+v((H=e.fundTransactionRequest)==null?void 0:H.type)+" Request ",1),i("div",null,v(n(f))+" "+v((z=e.token0)==null?void 0:z.symbol),1)]),i("div",rs,[_(ae,{activator:"parent",location:"left"},{activator:T(({props:g})=>[_(A,be(g,{icon:"ic:twotone-cancel",width:"1.5rem",onClick:s}),null,16)]),default:T(()=>[$(" Cancel "+v(e.fundTransactionRequest.type)+" Request ",1)]),_:1})]),t.value?tt((a(),R(re,{key:0,disabled:E.value,class:"pending_request__cancel_button bg-primary text-secondary",onClick:W},{prepend:T(()=>[E.value?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[$(" Cancel "+v(e.fundTransactionRequest.type)+" Request ",1)]),_:1},8,["disabled"])),[[nt,m]]):w("",!0)]),i("div",ls,[D[0]||(D[0]=i("div",null," Claimable ",-1)),i("div",ds,v(n(F))+" "+v((p=e.token1)==null?void 0:p.symbol),1)])])}}}),Ke=Y(us,[["__scopeId","data-v-2ba79c3a"]]),cs={style:{width:"100%"}},fs={class:"label"},ms={key:2,style:{width:"100%"}},_s={class:"buttons_group"},ps={key:0,class:"text-red mt-4 text-center"},hs={class:"deposit-flow mb-4"},vs={class:"label"},gs={class:"buttons_group"},ks={key:0},bs={key:1},ys={key:0,class:"text-red mt-4 text-center"},Ts=G({__name:"Deposit",emits:["deposit-success"],setup(e,{emit:o}){const l=o,r=Ue(),d=xe(),t=oe(),s=I(""),m=I(!1),c=b(()=>t.fund),{shouldUserRequestDeposit:f,shouldUserApproveAllowance:F,canUserProcessDeposit:E,shouldUserWaitSettlementOrCancelDeposit:W,userDepositRequest:y,userDepositRequestExists:k}=$e(t),D=I(!1),A=I(!1),H=I(!1),z=I(!1),p=I(!1),g=I(!1);Ce(()=>s.value,()=>{m.value=!0});const S=[B=>{var q,j;if(!c.value)return{message:"Fund data is missing.",display:!0};let h;try{h=Te(B,(q=c.value)==null?void 0:q.baseToken.decimals)}catch{return{message:`Make sure the value has max ${(j=c.value)==null?void 0:j.baseToken.decimals} decimals.`,display:!1}}if(h<=0)return{message:"Value must be positive.",display:!1};if(console.log("[DEPOSIT] check user base token balance wei: ",h,t.fundUserData.baseTokenBalance),!k.value&&t.fundUserData.baseTokenBalance<h){const ue=de(t.fundUserData.baseTokenBalance,c.value.baseToken.decimals);return{message:`Your ${c.value.baseToken.symbol} balance is too low: ${ue}.`,display:!0}}return!0}],x=b(()=>{var h,q,j;const B=(h=t.fund)==null?void 0:h.baseToken;return!((q=y==null?void 0:y.value)!=null&&q.amount)||!B?"N/A":de((j=y==null?void 0:y.value)==null?void 0:j.amount,B.decimals,!1)}),L=b(()=>D.value||A.value),K=b(()=>ee.value.length>0||L.value||!t.isUserWalletWhitelisted),ee=b(()=>S.map(B=>B(s.value||"0")).filter(B=>B!==!0)),te=b(()=>ee.value.filter(B=>B.display)),Q=b(()=>{var B,h;return(B=c.value)!=null&&B.baseToken?Te(s.value||"0",(h=c.value)==null?void 0:h.baseToken.decimals):0n}),ne=(B,h=!0)=>{D.value=!1,A.value=!1,[4001,100].includes(B==null?void 0:B.code)?r.addToast("Transaction was rejected."):(r.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(B),h&&t.fetchUserFundData(t.selectedFundChain,t.selectedFundAddress))},we=async()=>{if(!t.activeAccountAddress){r.errorToast("Connect your wallet to request deposit.");return}if(!c.value){r.errorToast("Fund data is missing.");return}console.log("REQUEST DEPOSIT"),D.value=!0,console.log("Request deposit tokensWei: ",Q.value,"from : ",t.activeAccountAddress);const B=ve("requestDeposit",[Q.value]);console.log("isConnectedWalletUsingLedger:",d.isConnectedWalletUsingLedger),console.log("contract:",t.fundContract),console.warn("connectedWallet",d==null?void 0:d.connectedWallet);try{await t.fundContract.send("fundFlowsCall",{},B).on("transactionHash",h=>{console.log("tx hash: ",h),r.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",h=>{console.log("receipt :",h),h.status?(r.successToast("Your deposit request was successful."),t.fundUserData.depositRequest={amount:Q.value,timestamp:Date.now(),type:We.Deposit},l("deposit-success")):(r.errorToast("Your deposit request has failed. Please contact the Rethink Finance support."),t.fetchUserFundData(t.selectedFundChain,t.selectedFundAddress)),D.value=!1}).on("error",h=>{ne(h,!1)})}catch(h){ne(h)}},ge=async()=>{var h,q;if(!t.activeAccountAddress){r.errorToast("Connect your wallet to deposit tokens to the vault.");return}if(!t.fund){r.errorToast("Vault data is missing.");return}if(!((h=y==null?void 0:y.value)!=null&&h.amount)){r.errorToast("Deposit request data is missing.");return}console.log("DEPOSIT tokensWei: ",(q=y==null?void 0:y.value)==null?void 0:q.amount,"from : ",t.activeAccountAddress),z.value=!0;const B=ve("deposit");try{await t.fundContract.send("fundFlowsCall",{},B).on("transactionHash",j=>{console.log("tx hash: "+j),r.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",j=>{console.log("receipt: ",j),t.fetchUserFundData(t.selectedFundChain,t.selectedFundAddress),j.status?(r.successToast("Your deposit was successful."),p.value=!1,l("deposit-success")):r.errorToast("The transaction has failed. Please contact the Rethink Finance support."),z.value=!1}).on("error",j=>{z.value=!1,console.error(j),r.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(j){z.value=!1,ne(j)}},U=()=>{s.value=x.value},V=async()=>{var h;if(!t.activeAccountAddress){r.errorToast("Connect your wallet to approve allowance.");return}if(!c.value){r.errorToast("Fund data is missing.");return}console.log("APPROVE ALLOWANCE"),A.value=!0,U(),console.log("Approve allowance tokensWei: ",Q.value,"from : ",t.activeAccountAddress);const B=Q.value;try{await t.fundBaseTokenContract.send("approve",{},(h=c.value)==null?void 0:h.address,Q.value).on("transactionHash",q=>{console.log("tx hash: "+q),r.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",q=>{console.log("receipt :",q),q.status?(r.successToast("The approval was successful. You can make the deposit now."),t.fundUserData.fundAllowance=B):r.errorToast("The transaction has failed. Please contact the Rethink Finance support."),A.value=!1}).on("error",q=>{ne(q,!1)})}catch(q){ne(q)}},P=b(()=>{var B;return console.log("fundStore.fundUserDataStore.fundUserDataStore.fundUserData: ",t.fundUserData),!!((B=t.fundUserData.depositRequest)!=null&&B.timestamp)}),M=b(()=>{var B,h,q,j,ue,ke;return!((B=t.fundUserData)!=null&&B.fundAllowance)||!((q=(h=t.fundUserData)==null?void 0:h.depositRequest)!=null&&q.amount)?!1:((j=t.fundUserData)==null?void 0:j.fundAllowance)>=((ke=(ue=t.fundUserData)==null?void 0:ue.depositRequest)==null?void 0:ke.amount)&&P.value}),N=b(()=>!t.fundUserData.fundDelegateAddress||!t.activeAccountAddress?!1:t.fundUserData.fundDelegateAddress.toLowerCase()===t.activeAccountAddress.toLowerCase()),me=b(()=>!1),_e=I([{name:"Request Deposit",onClick:we,isVisible:f,disabled:K,loading:D,tooltipText:b(()=>k.value?"Deposit request already exists. To change it, you first have to cancel the existing one.":t.isUserWalletWhitelisted?"":"Your wallet address is not whitelisted to allow deposits into this vault.")},{name:"Approve Amount",onClick:V,loading:A,isVisible:F,tooltipText:void 0}]),pe=b(()=>[{label:"1. Request Deposit",done:P.value,loading:D.value,isDisabled:!1},{label:"2. Approve Amount",done:M.value,loading:A.value,isDisabled:!1},{label:"3. Delegate to Myself",done:N.value&&M.value,loading:H.value},{label:"4. Process Deposit",done:me.value,isDisabled:W.value&&N.value,tooltip:"Wait for the next NAV update to process the deposit."}]),ie=()=>{P.value||we(),p.value=!0},X=b(()=>!P.value&&ee.value.length>0||!t.isUserWalletWhitelisted),Be=async()=>{var B,h;try{H.value=!0;const q=t.activeAccountAddress,j=(B=t.fund)==null?void 0:B.governanceToken.address,ue=(h=t.fund)==null?void 0:h.address;if(ue===Pe){r.errorToast("The vault address is not available. Please contact the Rethink Finance support.");return}let ke=t.fundContract;j!==ue&&j!==Pe&&(ke=t.fundGovernanceTokenContract),await ke.send("delegate",{},q).on("transactionHash",function(he){console.log("tx hash: "+he),r.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",function(he){console.log(he),he.status?(r.successToast("Delegation of Governance Tokens Succeeded"),q&&(t.fundUserData.fundDelegateAddress=q)):r.errorToast("The delegateTo tx has failed. Please contact the Rethink Finance support."),H.value=!1}).on("error",function(he){console.error(he),H.value=!1,r.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(q){console.error("Error delegating to external gov token: ",q),H.value=!1,r.errorToast("There has been an error. Please contact the Rethink Finance support.")}};return(B,h)=>{const q=Ge,j=Re("Icon"),ue=Oe,ke=Ke,he=Tt;return a(),u("div",cs,[n(P)?(a(),u("div",{key:1,class:"deposit-flow",onClick:ie},[h[5]||(h[5]=i("h3",{class:"title"}," Deposit in progress: ",-1)),(a(!0),u(O,null,ce(n(pe),(C,se)=>(a(),u("div",{key:se},[_(ae,{disabled:!C.isDisabled,activator:"parent",location:"top"},{default:T(()=>[$(v(C.tooltip),1)]),activator:T(({props:Ve})=>[i("div",be({ref_for:!0},Ve),[(a(),u("div",{key:se,class:le(["step",{is_disabled:C.isDisabled}])},[i("span",fs,v(C.label),1),C.done&&!C.isDisabled?(a(),R(j,{key:0,icon:"material-symbols:done",class:"text-success me-2",height:"1.2rem",width:"1.2rem"})):w("",!0),C.loading?(a(),R(Z,{key:1,class:"d-flex ms-2",size:"20",width:"3",indeterminate:""})):w("",!0)],2))],16)]),_:2},1032,["disabled"])]))),128))])):(a(),u(O,{key:0},[n(c)?(a(),R(q,{key:0,modelValue:n(s),"onUpdate:modelValue":h[0]||(h[0]=C=>ye(s)?s.value=C:null),token0:n(c).baseToken,token1:n(c).fundToken,"token0-user-balance":n(t).fundUserData.baseTokenBalance,"token1-user-balance":n(t).fundUserData.fundTokenBalance,"exchange-rate":n(t).baseToFundTokenExchangeRate},null,8,["modelValue","token0","token1","token0-user-balance","token1-user-balance","exchange-rate"])):w("",!0)],64)),h[10]||(h[10]=i("div",{class:"divider"},null,-1)),n(d).isConnected?(a(),u("div",ms,[i("div",_s,[_(ae,{disabled:n(t).isUserWalletWhitelisted,location:"bottom"},{default:T(()=>h[6]||(h[6]=[$(" Your wallet address is not whitelisted to allow deposits into this vault. ")])),activator:T(({props:C})=>[i("span",st(at(C)),[_(re,{class:"button_deposit button",variant:"outlined",disabled:n(X),onClick:ie},{default:T(()=>[$(v(n(P)?"Continue Deposit":"Deposit"),1)]),_:1},8,["disabled"])],16)]),_:1},8,["disabled"])]),n(te)&&n(m)?(a(),u("div",ps,[(a(!0),u(O,null,ce(n(te),(C,se)=>(a(),u("div",{key:se},v(C.message),1))),128))])):w("",!0),_(he,{modelValue:n(p),"onUpdate:modelValue":h[3]||(h[3]=C=>ye(p)?p.value=C:null),title:"Deposit Flow"},{default:T(()=>[i("div",hs,[(a(!0),u(O,null,ce(n(pe),(C,se)=>(a(),u("div",{key:se},[_(ae,{disabled:!C.isDisabled,activator:"parent",location:"top"},{default:T(()=>[$(v(C.tooltip),1)]),activator:T(({props:Ve})=>[i("div",be({ref_for:!0},Ve),[(a(),u("div",{key:se,class:le(["step",{is_disabled:C.isDisabled}])},[i("span",vs,v(C.label),1),C.done&&!C.isDisabled?(a(),R(j,{key:0,icon:"material-symbols:done",class:"text-success me-2",height:"1.2rem",width:"1.2rem"})):w("",!0),C.loading?(a(),R(Z,{key:1,class:"d-flex ms-2",size:"20",width:"3",indeterminate:""})):w("",!0)],2))],16)]),_:2},1032,["disabled"])]))),128))]),i("div",gs,[!n(N)&&n(M)?(a(),u(O,{key:0},[_(re,{class:"button",variant:"outlined",onClick:Be},{prepend:T(()=>[n(H)?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[h[7]||(h[7]=$(" Delegate to Myself "))]),_:1}),_(ue,{modelValue:n(g),"onUpdate:modelValue":h[1]||(h[1]=C=>ye(g)?g.value=C:null)},null,8,["modelValue"])],64)):n(E)||n(W)?(a(),u(O,{key:1},[n(W)?(a(),u("h3",ks," Wait for settlement or cancel the deposit request. ")):n(E)?(a(),u("h3",bs," You can now process or cancel the deposit request. ")):w("",!0),_(re,{class:"button",variant:"outlined",disabled:n(W),onClick:ge},{prepend:T(()=>[n(z)?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[h[8]||(h[8]=$(" Process Deposit "))]),_:1},8,["disabled"]),n(k)&&n(c)?(a(),R(ke,{key:2,"fund-transaction-request":n(y),"exchange-rate":n(t).baseToFundTokenExchangeRate,token0:n(c).baseToken,token1:n(c).fundToken,style:{width:"100%"},onCancelRequestSuccess:h[2]||(h[2]=C=>p.value=!1)},null,8,["fund-transaction-request","exchange-rate","token0","token1"])):w("",!0)],64)):w("",!0),(a(!0),u(O,null,ce(n(_e),C=>(a(),u(O,null,[C.isVisible?(a(),R(ae,{key:C.name,disabled:!C.tooltipText,bottom:""},{default:T(()=>[$(v(C.tooltipText),1)]),activator:T(({props:se})=>[i("span",be({ref_for:!0},se),[_(re,{class:"button",disabled:C.disabled,variant:"outlined",onClick:C.onClick},{prepend:T(()=>[C.loading?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[$(" "+v(C.name),1)]),_:2},1032,["disabled","onClick"])],16)]),_:2},1032,["disabled"])):w("",!0)],64))),256))]),n(te)&&n(m)?(a(),u("div",ys,[(a(!0),u(O,null,ce(n(te),(C,se)=>(a(),u("div",{key:se},v(C.message),1))),128))])):w("",!0)]),_:1},8,["modelValue"])])):(a(),R(re,{key:3,class:"bg-primary text-secondary button_connect_wallet",onClick:h[4]||(h[4]=C=>n(d).connectWallet())},{default:T(()=>h[9]||(h[9]=[$(" Connect Wallet ")])),_:1}))])}}}),ws=Y(Ts,[["__scopeId","data-v-e201a0e7"]]),Ds={style:{width:"100%"}},As={key:1},Fs={class:"buttons_group"},$s={key:0},Ss={key:1},Cs={key:0,class:"text-red mt-4 text-center"},xs=G({__name:"Redeem",setup(e){const o=Ue(),l=xe(),r=oe(),d=I(""),t=I(!1),s=b(()=>r.fund),m=I(!1),c=I(!1),f=I(!1),{shouldUserWaitSettlementOrCancelRedemption:F,userRedemptionRequestExists:E}=$e(r);Ce(()=>d.value,()=>{t.value=!0});const W=[p=>{var S,x;if(!s.value)return{message:"Fund data is missing.",display:!0};let g;try{g=Te(p||"0",(S=s.value)==null?void 0:S.fundToken.decimals)}catch{return{message:`Make sure the value has max ${(x=s.value)==null?void 0:x.fundToken.decimals} decimals.`,display:!1}}if(g<=0)return{message:"Value must be positive.",display:!1};if(console.log("[REDEEM] check user fund token balance wei: ",g,r.fundUserData.fundTokenBalance),r.fundUserData.fundTokenBalance<g){const L=de(r.fundUserData.fundTokenBalance,s.value.fundToken.decimals);return{message:`Your ${s.value.fundToken.symbol} balance is too low: ${L}.`,display:!0}}return!0}],y=b(()=>(k.value.length>0&&console.log("request redeem errors",k.value),k.value.length>0||m.value||!r.isUserWalletWhitelisted)),k=b(()=>W.map(p=>p(d.value||"0")).filter(p=>p!==!0)),D=b(()=>k.value.filter(p=>p.display)),A=(p,g=!0)=>{m.value=!1,c.value=!1,f.value=!1,[4001,100].includes(p==null?void 0:p.code)?o.addToast("Redeem transaction was rejected."):(o.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(p),g&&r.fetchUserFundData(r.selectedFundChain,r.selectedFundAddress))},z=I([{name:"Request Redemption",onClick:async()=>{if(!r.activeAccountAddress){o.errorToast("Connect your wallet to redeem tokens from the vault.");return}if(!s.value){o.errorToast("Vault data is missing.");return}console.log("[REQUEST REDEMPTION]"),m.value=!0;const p=Te(d.value||"0",s.value.fundToken.decimals);console.log("[REDEEM] tokensWei: ",p,"from : ",r.activeAccountAddress);const g=ve("requestWithdraw",[p]);try{await r.fundContract.send("fundFlowsCall",{},g).on("transactionHash",S=>{console.log("tx hash: "+S),o.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",S=>{console.log(S),S.status?(o.successToast("Your withdrawal request was successful. It may take 10 seconds or more for values to update."),r.fundUserData.redemptionRequest={amount:p,timestamp:Date.now(),type:We.Redemption},d.value=""):o.errorToast("The transaction has failed. Please contact the Rethink Finance support."),m.value=!1}).on("error",S=>{A(S,!1)})}catch(S){A(S)}},disabled:y,loading:m,isVisible:b(()=>!E.value),tooltipText:b(()=>E.value?"Redemption request already exists. To change it, you first have to cancel the existing one.":r.isUserWalletWhitelisted?"":"Your wallet address is not whitelisted to allow deposits into this vault.")}]);return(p,g)=>{const S=Ge;return a(),u("div",Ds,[n(s)?(a(),R(S,{key:0,modelValue:n(d),"onUpdate:modelValue":g[0]||(g[0]=x=>ye(d)?d.value=x:null),token0:n(s).fundToken,token1:n(s).baseToken,"token0-user-balance":n(r).fundUserData.fundTokenBalance,"token1-user-balance":n(r).fundUserData.baseTokenBalance,"exchange-rate":n(r).fundToBaseTokenExchangeRate},null,8,["modelValue","token0","token1","token0-user-balance","token1-user-balance","exchange-rate"])):w("",!0),g[3]||(g[3]=i("div",{class:"divider"},null,-1)),n(l).isConnected?(a(),u("div",As,[i("div",Fs,[n(F)?(a(),u("h3",$s,"Wait for settlement or cancel the redemption request.")):n(E)?(a(),u("h3",Ss,"You can now process or cancel the redemption request.")):w("",!0),(a(!0),u(O,null,ce(n(z),x=>(a(),u(O,null,[x.isVisible?(a(),R(ae,{key:x.name,location:"bottom",disabled:!x.tooltipText,bottom:""},{default:T(()=>[$(v(x.tooltipText),1)]),activator:T(({props:L})=>[i("span",be({ref_for:!0},L),[_(re,{class:"button",disabled:x.disabled,variant:"outlined",onClick:x.onClick},{prepend:T(()=>[x.loading?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[$(" "+v(x.name),1)]),_:2},1032,["disabled","onClick"])],16)]),_:2},1032,["disabled"])):w("",!0)],64))),256))]),n(D)&&n(t)?(a(),u("div",Cs,[(a(!0),u(O,null,ce(n(D),(x,L)=>(a(),u("div",{key:L},v(x.message),1))),128))])):w("",!0)])):(a(),R(re,{key:2,class:"bg-primary text-secondary button_connect_wallet",onClick:g[1]||(g[1]=x=>n(l).connectWallet())},{default:T(()=>g[2]||(g[2]=[$(" Connect Wallet ")])),_:1}))])}}}),Rs=Y(xs,[["__scopeId","data-v-c0c0283f"]]),Us={name:"Settlement",props:{fund:{type:Object,default:()=>{}},shouldUserDelegate:{type:Boolean,default:!1}},data(){return{selectedActionButtonValue:"deposit",isDelegateDialogOpen:!1,selectItems:[{key:"deposit",label:"Deposit"},{key:"redeem",label:"Redeem"}]}},computed:{isSelectedDepositButton(){return this.selectedActionButtonValue==="deposit"},isSelectedRedeemButton(){return this.selectedActionButtonValue==="redeem"}},methods:{selectActionButton(e){this.selectedActionButtonValue=e},openDelegateDialog(){console.log("openDelegateDialog"),console.log("this.shouldUserDelegate: ",this.shouldUserDelegate),this.shouldUserDelegate&&(this.isDelegateDialogOpen=!0)}}},Bs={class:"fund_settlement"},Vs={class:"card_header"},qs={class:"fund_settlement__card_boxes"},Ps={key:0,class:"card_box"};function Ns(e,o,l,r,d,t){const s=bt,m=ws,c=Rs,f=Oe;return a(),u("div",Bs,[i("div",Vs,[o[2]||(o[2]=i("div",{class:"card_header__title subtitle_white"}," Manage Deposits ",-1)),_(s,{modelValue:d.selectedActionButtonValue,"onUpdate:modelValue":[o[0]||(o[0]=F=>d.selectedActionButtonValue=F),t.selectActionButton],items:d.selectItems,class:"fund_settlement__buttons"},null,8,["modelValue","items","onUpdate:modelValue"])]),i("div",qs,[d.selectedActionButtonValue?(a(),u("div",Ps,[t.isSelectedDepositButton?(a(),R(m,{key:0})):t.isSelectedRedeemButton?(a(),R(c,{key:1})):w("",!0)])):w("",!0)]),_(f,{modelValue:d.isDelegateDialogOpen,"onUpdate:modelValue":o[1]||(o[1]=F=>d.isDelegateDialogOpen=F)},null,8,["modelValue"])])}const Is=Y(Us,[["render",Ns],["__scopeId","data-v-4f5e49c7"]]),Es={class:"fund_settlement"},Ws={class:"card_header"},Ms={key:0,class:"fund_settlement__buttons"},Os={key:1},Ls={key:0,class:"fund_settlement__no_pending_requests"},js={key:1},zs={key:2,class:"fund_settlement__pending_requests"},Ys={key:3,class:"fund_settlement__no_pending_requests"},Hs={class:"text-primary"},Gs=G({__name:"index",props:{fund:{type:Object,default:()=>{}}},emits:["deposit-success"],setup(e,{emit:o}){const l=o,r=je(),d=Ue(),t=Se(),s=oe(),m=xe(),{fundUserData:c,userDepositRequest:f,userRedemptionRequest:F,baseToFundTokenExchangeRate:E,fundToBaseTokenExchangeRate:W,shouldUserWaitSettlementOrCancelDeposit:y,shouldUserWaitSettlementOrCancelRedemption:k,userDepositRequestExists:D,userRedemptionRequestExists:A}=$e(s),H=b(()=>t.isActionState("fetchUserFundDepositRedemptionRequests",De.Loading)),z=e,p=b(()=>K.value?!0:!(!ee.value||!te.value)),g=()=>{D.value&&ne(),A.value&&we()},S=I(!1),x=I(!1),L=I(""),K=b(()=>S.value||x.value),ee=b(()=>{var U;return D.value?c.value.fundAllowance<(((U=f==null?void 0:f.value)==null?void 0:U.amount)||0n)?"Not enough allowance to process the deposit request.":y.value?"Wait for settlement or cancel the deposit request.":s.isUserWalletWhitelisted?"":"Your wallet address is not whitelisted to allow deposits into this vault.":"There is no deposit request."}),te=b(()=>{var _e,pe,ie,X;const U=((_e=F==null?void 0:F.value)==null?void 0:_e.amount)||0n;if(!A.value)return"There is no redemption request.";if(c.value.fundTokenBalance<U)return"Not enough vault tokens to process the redemptions request.";if(k.value)return"Wait for settlement or cancel the redemption request.";const V=((pe=s.fund)==null?void 0:pe.fundContractBaseTokenBalance)||0n,P=fe.fromString(s.fundToBaseTokenExchangeRate.toString()),M=fe.fromString(Ae(U,(ie=s.fund)==null?void 0:ie.fundToken.decimals)),N=P.mul(M);return fe.fromString(Ae(V,(X=s.fund)==null?void 0:X.baseToken.decimals)).lt(N)?"Not enough liquidity in the vault contract.":s.isUserWalletWhitelisted?"":"Your wallet address is not whitelisted to allow deposits into this vault."}),Q=async()=>{const U=s.activeAccountAddress??"",V=s.selectedFundChain;if(!U){d.errorToast("No active account, try re-authenticating.");return}const[P,M]=await Promise.allSettled([()=>s.fundGovernanceTokenContract.methods.eip712Domain().call(),()=>s.fundGovernanceTokenContract.methods.nonces(U).call()].map(X=>m.requestConcurrencyLimit(()=>r.callWithRetry(V,X)))),N=P.status==="fulfilled"?P.value:void 0,me=M.status==="fulfilled"?M.value:void 0;console.log("depositAndDelegateBySig domain data ",N);const _e=Math.floor(Date.now()/1e3)+3600,pe=ss(U,_e,me,N.name,N.verifyingContract,N.chainId,N.version);console.log("dataToSign",JSON.stringify(pe,null,2));let ie;try{const X=r.chainProviders[s.selectedFundChain],Be=await(X==null?void 0:X.eth.signTypedData(U??"",pe));ie=it.from(Be)}catch(X){console.error("Error signing message:",X);return}return ve("depositAndDelegateBySig",[U,me,_e,ie.v,ie.r,ie.s])},ne=async()=>{var V,P,M;if(!s.activeAccountAddress){d.errorToast("Connect your wallet to deposit tokens to the vault.");return}if(!s.fund){d.errorToast("vault data is missing.");return}if(!((V=f==null?void 0:f.value)!=null&&V.amount)){d.errorToast("Deposit request data is missing.");return}console.log("DEPOSIT tokensWei: ",(P=f==null?void 0:f.value)==null?void 0:P.amount,"from : ",s.activeAccountAddress),S.value=!0;let U;if(((M=s.fundUserData)==null?void 0:M.fundDelegateAddress)===Pe){let N;try{U=await Q(),console.warn("signed delegateBySigData",N)}catch(me){console.error("failed signing delegate by sig data",me),U=ve("deposit")}}else U=ve("deposit");try{await s.fundContract.send("fundFlowsCall",{},U).on("transactionHash",N=>{console.log("tx hash: "+N),d.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",N=>{console.log("receipt: ",N),s.fetchUserFundData(s.selectedFundChain,s.selectedFundAddress),N.status?(d.successToast("Your deposit was successful."),l("deposit-success")):d.errorToast("The transaction has failed. Please contact the Rethink Finance support."),S.value=!1}).on("error",N=>{S.value=!1,console.error(N),d.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(N){S.value=!1,ge(N)}},we=async()=>{var V,P;if(!s.activeAccountAddress){d.errorToast("Connect your wallet to redeem tokens from the vault.");return}if(!s.fund){d.errorToast("vault data is missing.");return}if(!((V=F==null?void 0:F.value)!=null&&V.amount)){d.errorToast("Redemption request data is missing.");return}console.log("[REDEEM]"),x.value=!0,console.log("[REDEEM] tokensWei: ",(P=F==null?void 0:F.value)==null?void 0:P.amount,"from : ",s.activeAccountAddress);const U=ve("withdraw");try{await s.fundContract.send("fundFlowsCall",{},U).on("transactionHash",M=>{console.log("tx hash: "+M),d.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",M=>{console.log("receipt: ",M),s.fetchUserFundData(s.selectedFundChain,s.selectedFundAddress),M.status?d.successToast("Your redemption was successful. It may take 10 seconds or more for values to update."):d.errorToast("The transaction has failed. Please contact the Rethink Finance support."),x.value=!1}).on("error",M=>{ge(M)})}catch(M){ge(M)}},ge=U=>{x.value=!1,[4001,100].includes(U==null?void 0:U.code)?d.addToast("Transaction was rejected."):(d.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(U))};return ot(async()=>{var U,V;await ze((U=z.fund)==null?void 0:U.chainId,(V=z.fund)==null?void 0:V.plannedSettlementPeriod).then(P=>{L.value=P}).catch(P=>{console.error("Error parsing planned settlement",P)})}),(U,V)=>{const P=Ke,M=wt;return a(),u("div",Es,[i("div",Ws,[V[1]||(V[1]=i("div",{class:"card_header__title subtitle_white"}," Pending Requests ",-1)),n(D)||n(A)?(a(),u("div",Ms,[_(ae,{disabled:!(n(D)&&n(ee)||n(A)&&n(te)),activator:"parent",location:"bottom"},{activator:T(N=>[_(re,be(N,{disabled:n(p),onClick:g}),{prepend:T(()=>[n(K)?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):w("",!0)]),default:T(()=>[V[0]||(V[0]=$(" Process Request "))]),_:2},1040,["disabled"])]),default:T(()=>[n(D)?(a(),u(O,{key:0},[$(v(n(ee)),1)],64)):w("",!0),n(D)&&n(A)?(a(),u("br",Os)):w("",!0),n(A)?(a(),u(O,{key:2},[$(v(n(te)),1)],64)):w("",!0)]),_:1},8,["disabled"])])):w("",!0)]),n(m).isConnected?n(H)?(a(),u("div",js,[_(Ie,{type:"list-item-two-line"}),_(Ie,{type:"list-item-two-line"})])):n(D)||n(A)?(a(),u("div",zs,[n(D)?(a(),R(P,{key:0,"fund-transaction-request":n(f),"exchange-rate":n(E),token0:e.fund.baseToken,token1:e.fund.fundToken},null,8,["fund-transaction-request","exchange-rate","token0","token1"])):w("",!0),n(A)?(a(),R(P,{key:1,"fund-transaction-request":n(F),"exchange-rate":n(W),token1:e.fund.baseToken,token0:e.fund.fundToken},null,8,["fund-transaction-request","exchange-rate","token1","token0"])):w("",!0)])):(a(),u("div",Ys," Currently there are no deposit or redemption requests. ")):(a(),u("div",Ls," Connect your wallet to view deposit or redemption requests. ")),_(M,null,{default:T(()=>[V[2]||(V[2]=$(" The deposit and redeem requests are settled within the planned Settlement Cycle of ")),i("span",Hs,v(n(L)),1),V[3]||(V[3]=$(". You can learn more about how settlements work ")),V[4]||(V[4]=i("a",{class:"text-primary",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},"here",-1)),V[5]||(V[5]=$(". "))]),_:1})])}}}),Ks=Y(Gs,[["__scopeId","data-v-e2ed7df8"]]);var J=(e=>(e.NAV="nav",e.SHARE_PRICE="share-price",e))(J||{});const qe={nav:"var(--color-primary)","share-price":"var(--color-primary)"},Ee={nav:{value:"NAV",key:"nav"},"share-price":{value:"Share Price",key:"share-price"}},Zs={class:"price_type_selector"},Js={class:"price_type_selector__price"},Qs={key:1},Xs={class:"price_type_selector__selected"},ea={key:0,class:"price_type_selector__options"},ta=["onClick"],na=G({__name:"TypeSelector",props:{value:{},selected:{},typeOptions:{},isLoading:{type:Boolean}},emits:["update:selected"],setup(e,{emit:o}){const l=e,r=o,d=I(!1),t=b(()=>Ee[l.selected].value),s=b(()=>Object.keys(l.typeOptions).length>1),m=f=>{r("update:selected",f.key),d.value=!1},c=()=>{s.value&&(d.value=!d.value)};return(f,F)=>{const E=Dt;return a(),u("div",Zs,[i("div",{class:le(["price_type_selector__select_button",{"price_type_selector__select_button--hover":n(s)}]),onClick:c},[i("div",null,[i("div",Js,[f.isLoading?(a(),R(Z,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):(a(),u("span",Qs,v(f.value),1))]),i("div",Xs,v(n(t)),1)]),n(s)?(a(),R(E,{key:0,active:n(d)},null,8,["active"])):w("",!0)],2),n(d)?(a(),u("div",ea,[(a(!0),u(O,null,ce(f.typeOptions,W=>(a(),u("div",{key:W.key,class:le(["price_type_selector__option",{"option-active":f.selected===W.key}]),onClick:y=>m(W)},v(W.value),11,ta))),128))])):w("",!0)])}}}),sa=Y(na,[["__scopeId","data-v-aaf021c0"]]);function aa(e,o){return Ze(`fetchFundNavUpdates_${e}_${o}`,()=>oa(e,o))}async function oa(e,o){console.debug("[BACKEND] FETCH Fund NAV updates ",e,o);const l=rt(),r=await fetch(`${l.public.BACKEND_URL}/nav/nav-updates/${o}?fundChainId=${e}`);if(!r.ok)return console.error(`[BACKEND] Failed to fetch NAV updates for fund ${e} ${o}:`,r.statusText),[];const d=await r.json();return console.debug("[BACEKDN] Fund ",e,o," NAV UPDATES",d),ia(d)}const ia=e=>e.map(o=>({...o,totalNAV:o.totalNAV!=null?BigInt(o.totalNAV):null,sharePrice:Number(o.sharePrice),totalDepositBalance:o.totalDepositBalance!=null?BigInt(o.totalDepositBalance):null,navParts:typeof o.navParts=="string"?JSON.parse(o.navParts,lt):o.navParts||{}})),ra=(e,o=1)=>{const l=parseFloat(e);if(isNaN(l))return e;const r=["K","M","B","T"];let d=l,t="";for(let s=r.length-1;s>=0;s--){const m=Math.pow(1e3,s+1);if(l>=m){d=l/m,t=r[s];break}}return Ne(d.toFixed(o))+t},la={key:0,class:"chart"},da={class:"chart__toolbar"},ua={class:"chart__chart_wrapper"},ca={key:1,class:"meta"},fa={key:1,class:"w-100 d-flex justify-center align-center h-100"},ma=G({__name:"index",props:{fund:{}},setup(e){const o=oe(),l=At(),r=je(),d=Se(),t=e,s=I(J.NAV),m=I([]),c=I(!0),f=b(()=>{var g;return{[J.NAV]:o.fundTotalNAVFormattedShort,[J.SHARE_PRICE]:((g=m.value[m.value.length-1])==null?void 0:g.toString())||"0"}[s.value]}),F=b(()=>[{name:Ee[s.value].value,data:y.value}]),E=b(()=>d.isActionState("fetchFundNAVDataAction",De.Loading)),W=b(()=>{var p,g;return((g=(p=t.fund)==null?void 0:p.navUpdates)==null?void 0:g.map(S=>S.totalNAV||0n))||[]}),y=b(()=>{var g,S;return{[J.NAV]:((S=(g=t.fund)==null?void 0:g.navUpdates)==null?void 0:S.map(x=>{var L;return parseFloat(Ae(x.totalNAV||0n,(L=t.fund)==null?void 0:L.baseToken.decimals))}))||[],[J.SHARE_PRICE]:m.value}[s.value]}),k=b(()=>{var g,S,x,L;return{[J.NAV]:((S=(g=t.fund)==null?void 0:g.navUpdates)==null?void 0:S.map(K=>K.date))||[],[J.SHARE_PRICE]:((L=(x=t.fund)==null?void 0:x.navUpdates)==null?void 0:L.map(K=>K.date))||[]}[s.value]}),D=b(()=>{var p;return{chart:{id:"nav-area-chart",type:"area",background:"var(--color-gray-light-transparent)",stacked:!1,zoom:{enabled:!1},toolbar:{show:!1}},dataLabels:{enabled:!1},context:{navUpdates:((p=t.fund)==null?void 0:p.navUpdates)||[]},markers:{size:0,colors:["transparent"],strokeColors:qe[s.value],strokeWidth:2},grid:{show:!1,padding:{right:0}},fill:{type:"gradient",gradient:{shadeIntensity:1,inverseColors:!1,opacityFrom:.25,opacityTo:.1,type:"vertical",stops:[20,100]},colors:[qe[s.value]]},stroke:{show:!0,curve:"straight",lineCap:"round",width:2,colors:[qe[s.value]]},yaxis:{min:Math.min(...y.value)*.95,max:Math.max(...y.value)*1.05,forceNiceScale:!0,labels:{style:{colors:"var(--color-light-subtitle)"},offsetX:0,formatter:g=>ra(g,3)},axisBorder:{show:!1},axisTicks:{show:!1}},xaxis:{categories:k.value,tickAmount:4,axisBorder:{show:!1},axisTicks:{show:!1},crosshairs:{show:!1},tooltip:{enabled:!1},labels:{style:{colors:"var(--color-light-subtitle)"}}},tooltip:{theme:"dark",custom:({series:g,seriesIndex:S,dataPointIndex:x,w:L})=>{const K=W.value[x],ee=m.value[x];return`
          <div class='custom_tooltip'>
            <div class='tooltip_row'>
              <div class='label'>Date:</div> ${L.globals.categoryLabels[x]}
            </div>
            <div class='tooltip_row'>
              <div class='label'>${s.value===J.NAV?"NAV":"Share Price"}:</div>
              ${s.value===J.NAV?A(K):ee}
            </div>
          </div>
        `}}}}),A=p=>{var g,S;return de(p,(g=t.fund)==null?void 0:g.baseToken.decimals)+" "+((S=t.fund)==null?void 0:S.baseToken.symbol)},H=async()=>{var S,x;c.value=!0;const p=await l.initializeBlockTimeContext(t.fund.chainId,!1),g=(p==null?void 0:p.averageBlockTime)||0;m.value=await Promise.all((x=(S=t.fund)==null?void 0:S.navUpdates)==null?void 0:x.map(async L=>{var te;const K=Te(String(L.totalNAV||"0"),(te=t.fund)==null?void 0:te.baseToken.decimals),ee=Number(await l.getBlockByTimestamp(t.fund.chainId,L.timestamp/1e3,g)||0);try{const Q=await r.callWithRetry(t.fund.chainId,()=>r.getCustomContract(t.fund.chainId,Je,t.fund.fundToken.address).methods.totalSupply().call({},ee)),ne=Te(String(Q||"0"),t.fund.fundToken.decimals),we=t.fund.baseToken.decimals,ge=t.fund.fundToken.decimals,U=we-ge,V=U<0?K*10n**BigInt(-U):K,P=U>0?ne*10n**BigInt(U):ne,M=10n**36n,N=ne>0n?V*M/P:0n;return parseFloat(Ae(N,36))}catch(Q){return console.error("Error getting share price",Q),0}})),c.value=!1},z=()=>{c.value=!0,aa(t.fund.chainId,t.fund.address).then(p=>{console.warn("TTT fetchFundNavUpdatesAction ",t.fund.chainId,t.fund.address,p),m.value=p.map(g=>g.sharePrice),console.debug("TTT fetchFundNavUpdatesAction ",t.fund.chainId,t.fund.address,p),c.value=!1}).catch(p=>{console.error(`Failed fetchFundNavUpdatesAction for ${t.fund.address}`,p),c.value=!1,H()})};return Ce(()=>s.value,()=>{var p;s.value===J.SHARE_PRICE&&t.fund&&!((p=m.value)!=null&&p.length)&&z()},{immediate:!0}),(p,g)=>{const S=sa,x=Re("apexchart"),L=dt;return n(E)?w("",!0):(a(),u("div",la,[i("div",da,[i("div",null,[_(S,{selected:n(s),"onUpdate:selected":g[0]||(g[0]=K=>ye(s)?s.value=K:null),value:n(f),"is-loading":n(c)&&n(s)===n(J).SHARE_PRICE,"type-options":n(Ee)},null,8,["selected","value","is-loading","type-options"])])]),i("div",ua,[n(c)&&n(s)===n(J).SHARE_PRICE?(a(),R(Ie,{key:0,type:"ossein",height:"400px",width:"100%"})):(a(),u("div",ca,[_(L,null,{default:T(()=>[n(y).length>0?(a(),R(x,{key:0,height:"400",width:"100%",options:n(D),series:n(F)},null,8,["options","series"])):(a(),u("div",fa,g[1]||(g[1]=[i("h3",null," No NAV updates available yet. ",-1)])))]),_:1})]))])]))}}}),_a=Y(ma,[["__scopeId","data-v-6d1ee23f"]]),pa={class:"fund_details"},ha={class:"main_card"},va={class:"d-flex flex-column"},ga={class:"main_card main_grid order-1 order-sm-0"},ka={class:"main_card"},Za=G({__name:"index",setup(e){const o=oe(),{shouldUserDelegate:l}=$e(o),r=ut().fund;return(d,t)=>{const s=Zt,m=Pn,c=Is,f=Ks,F=_a;return a(),u("div",pa,[_(s,{fund:n(r)},null,8,["fund"]),i("div",ha,[_(m,{fund:n(r)},null,8,["fund"])]),i("div",va,[i("div",ga,[_(c,{fund:n(r),"should-user-delegate":n(l)},null,8,["fund","should-user-delegate"]),_(f,{fund:n(r)},null,8,["fund"])]),i("div",ka,[_(F,{fund:n(r)},null,8,["fund"])])])])}}});export{Za as default};
