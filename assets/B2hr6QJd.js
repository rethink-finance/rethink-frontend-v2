import{u as N}from"./CL_pIM7N.js";import{d as Y,u as $,P as q,r as V,h as D,f as _,b as g,w as i,a as b,l as H,e as t,cF as v,c as h,p as T,cD as U,V as y,i as I,Z as F,o as n,_ as z}from"./D3HDfnxy.js";import{f as P}from"./Ce8rn2uW.js";import{V as G}from"./LimOvMzi.js";import{b as S}from"./BFVrtpKD.js";import{b as Z}from"./C8Z2lGgf.js";const O={class:"page-governance"},W={class:"main_card di-card"},j={class:"di-card__header-container"},J={class:"di-card__content"},K=["innerHTML"],Q={key:1,class:"di-card__button-container"},X={key:2,class:"di-card__someone-else-container"},ee=Y({__name:"ModalDelegateVotes",props:{modelValue:Boolean},emits:["update:modelValue","delegate-success"],setup(B,{emit:R}){const A=R,s=N(),c=$();q();const a=V(!1),l=V(!1),u=V(""),x=[P.required,P.isValidAddress],E=D(()=>x.every(o=>o(u.value)===!0)),L=D(()=>(s==null?void 0:s.fundUserData.fundDelegateAddress.toLowerCase())===s.activeAccountAddress),M=D(()=>{const o=s==null?void 0:s.fundUserData.fundDelegateAddress;console.log("delegateAddress: ",o);let e=`You have delegated to ${o}`;return s!=null&&s.shouldUserDelegate?e="You have not delegated to anyone yet.<br><br><strong>NOTE: </strong>You must always delegate to yourself first, even if you want to delegate to someone else!":o.toLowerCase()===s.activeAccountAddress&&(e="You have delegated to yourself."),e}),k=()=>{l.value=!1,u.value="",A("update:modelValue",!1)},C=async(o=!1)=>{var e,p;try{a.value=!0;const d=o?s.activeAccountAddress:u.value,m=(e=s.fund)==null?void 0:e.governanceToken.address,r=(p=s.fund)==null?void 0:p.address;if(r===F){c.errorToast("The vault address is not available. Please contact the Rethink Finance support.");return}let w=s.fundContract;m!==r&&m!==F&&(w=s.fundGovernanceTokenContract),await w.send("delegate",{},d).on("transactionHash",function(f){console.log("tx hash: "+f),c.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",function(f){console.log(f),f.status?(c.successToast("Delegation of Governance Tokens Succeeded"),A("delegate-success"),k(),d&&(s.fundUserData.fundDelegateAddress=d)):c.errorToast("The delegateTo tx has failed. Please contact the Rethink Finance support."),a.value=!1}).on("error",function(f){console.error(f),a.value=!1,c.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(d){console.error("Error delegating to external gov token: ",d),a.value=!1,c.errorToast("There has been an error. Please contact the Rethink Finance support.")}};return(o,e)=>{const p=H("Icon");return n(),_("div",O,[g(G,{"model-value":B.modelValue,scrim:"black",opacity:"0.3","max-width":"600","onUpdate:modelValue":k},{default:i(()=>{var d,m;return[b("div",W,[b("div",j,[e[5]||(e[5]=b("div",{class:"di-card__header"}," Delegate ",-1)),g(p,{icon:"material-symbols:close",class:"di-card__close-icon",width:"1.5rem",onClick:e[0]||(e[0]=r=>t(l)?l.value=!1:k())})]),b("div",J,[!t(l)||t(l)&&((d=t(s))!=null&&d.shouldUserDelegate)?(n(),_("div",{key:0,class:"di-card",innerHTML:t(M)},null,8,K)):v("",!0),t(l)?(n(),_("div",X,[g(S,{class:"di-card__label label_required"},{default:i(()=>e[8]||(e[8]=[T(" Address ")])),_:1}),g(Z,{modelValue:t(u),"onUpdate:modelValue":e[3]||(e[3]=r=>I(u)?u.value=r:null),placeholder:"Enter the address of the delegate",rules:x,required:""},null,8,["modelValue"]),g(y,{disabled:!t(E)||t(a),class:"di-card__delegate-votes",variant:"flat",color:"rgba(210, 223, 255, 1)",onClick:e[4]||(e[4]=r=>C())},{prepend:i(()=>[t(a)?(n(),h(U,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):v("",!0)]),default:i(()=>[e[9]||(e[9]=T(" Delegate votes "))]),_:1},8,["disabled"])])):(n(),_("div",Q,[t(L)?v("",!0):(n(),h(y,{key:0,disabled:t(a),class:"di-card__submit-button",variant:"outlined",onClick:e[1]||(e[1]=r=>C(!0))},{prepend:i(()=>[t(a)?(n(),h(U,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):v("",!0)]),default:i(()=>[e[6]||(e[6]=T(" Myself "))]),_:1},8,["disabled"])),(m=t(s))!=null&&m.shouldUserDelegate?v("",!0):(n(),h(y,{key:1,disabled:t(a),class:"di-card__submit-button",variant:"outlined",onClick:e[2]||(e[2]=r=>l.value=!0)},{default:i(()=>e[7]||(e[7]=[T(" Someone else ")])),_:1},8,["disabled"]))]))])])]}),_:1},8,["model-value"])])}}}),ne=z(ee,[["__scopeId","data-v-5a85c32d"]]);export{ne as _};
