import z from"./DXxM2RMs.js";import ee from"./QZVO053q.js";import{_ as ae}from"./BhipA0pl.js";import{v as te,x as se,dA as oe,cQ as ne,G as le,b as s,L as re,cX as de,J as ie,d as ue,cZ as ce,u as pe,c9 as me,r as V,ca as fe,cb as ve,h as M,cf as _e,d5 as O,f as w,a as o,w as n,i as $,e as t,p as m,c8 as F,Q as ge,cF as N,V as be,c as he,d0 as Ve,d6 as we,o as _,_ as Ne}from"./D3HDfnxy.js";import{u as Te,k as W,s as G,l as ye,m as Ae,n as ke}from"./CL_pIM7N.js";import{V as Ue}from"./DzKiJ9cp.js";import"./Dzq1tP6X.js";import{V as c}from"./DjkxKK4u.js";import{b as T}from"./BFVrtpKD.js";import{b as Ce}from"./C8Z2lGgf.js";import{V as B}from"./CnuNmnUl.js";import{V as Pe}from"./BIwcGVZU.js";import{V as xe,a as Me,b as Fe,c as Be}from"./D-HsWzDh.js";import{V as Se}from"./Cg7Ey17u.js";import"./BKgeRXoF.js";import"./brVXf9Dm.js";import"./Dxh0CgvK.js";import"./DmMfJ0RA.js";import"./cVa1OdO9.js";import"./Ce8rn2uW.js";import"./BqVuMM-N.js";import"./Wy3Wx6Ei.js";import"./ERRp_wCL.js";import"./9IxLmHHa.js";import"./COuEhvrh.js";import"./DWe-URJs.js";import"./CJiquoOh.js";import"./8pzO0o2T.js";import"./DPhX8wWY.js";import"./CH598blW.js";import"./BAneylHg.js";import"./D3jptR6C.js";import"./CgAV7UTW.js";import"./DkcdTJJR.js";const Ee=se({fluid:{type:Boolean,default:!1},...ie(),...de(),...re()},"VContainer"),Re=te()({name:"VContainer",props:Ee(),setup(f,y){let{slots:A}=y;const{rtlClasses:l}=oe(),{dimensionStyles:g}=ne(f);return le(()=>s(f.tag,{class:["v-container",{"v-container--fluid":f.fluid},l.value,f.class],style:[g.value,f.style]},A)),{}}}),De={class:"header"},Le={class:"main_header__subtitle"},Ie={class:"main_card"},qe={class:"proposal_title_field"},Je={class:"proposal_title_field__char_limit"},Oe={class:"management"},$e={class:"management__card"},We={class:"management__row"},Ge={class:"d-inline-block"},He={class:"management__info"},je={class:"management__card"},Qe={class:"management__row"},Ye={class:"management__card--no-margin"},Ke={class:"management__row"},Xe={class:"d-flex flex-grow-1 justify-space-between align-center me-4"},Ze={class:"nav_methods_title"},ze={key:0,class:"text-success"},ea={key:1,class:"text-error"},aa={key:2},ta={class:"action_buttons"},sa=ue({__name:"Proposal",emits:["updateBreadcrumbs"],setup(f,{emit:y}){const A=Ve(),l=Te(),g=ce(),i=pe(),S=y,{selectedFundAddress:E,selectedFundSlug:b,fundManagedNAVMethods:u,fundLastNAVUpdate:R,fundLastNAVUpdateMethods:H}=me(l),r=V({title:"",allowManagerToUpdateNav:!1,collectManagementFees:!1,processWithdraw:!1,description:""}),j=[{title:"NAV Methods",disabled:!1,to:`/details/${b.value}/nav`},{title:"Manage NAV Methods",disabled:!1,to:`/details/${b.value}/nav/manage`},{title:"Create NAV Proposal",disabled:!0,to:`/details/${b.value}/nav/manage/proposal`}],Q=V(null),p=V(!1),k=V(!1);fe(()=>{S("updateBreadcrumbs",j)}),ve(()=>{S("updateBreadcrumbs",[])});const U=M(()=>u.value.filter(d=>d.isNew).length??0),C=M(()=>u.value.filter(d=>d.deleted).length??0),Y=M(()=>R.value?R.value.date??"N/A":"N/A"),K=async()=>{var h;const d=ye(u.value,(h=l.fund)==null?void 0:h.baseToken.decimals,r.value.processWithdraw),e=Ae(d,l.fundAddress,!0,r.value.collectManagementFees,!0);p.value=!0;try{await l.fundGovernorContract.send("propose",{},e.targets,e.gasValues,e.calldatas,JSON.stringify({title:r.value.title,description:r.value.description})).on("transactionHash",a=>{console.log("tx hash: "+a),i.addToast("The proposal transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",a=>{console.log("receipt: ",a),a.status?(P(),i.successToast("Register the proposal transactions was successful. You can now vote on the proposal in the governance page."),A.push(`/details/${b.value}/governance`)):i.errorToast("The register proposal transaction has failed. Please contact the Rethink Finance support."),p.value=!1}).on("error",a=>{console.error(a),p.value=!1,i.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(a){p.value=!1,i.errorToast(a.message)}if(p.value=!0,!r.value.allowManagerToUpdateNav)return;const x=await l.fetchRoleModAddress(l.fundAddress),v=ke(d,l.fundAddress,l.selectedFundChain,x);try{await l.fundGovernorContract.send("propose",{},v.targets,v.gasValues,v.calldatas,JSON.stringify({title:"Allow Manager to Keep Updating - "+r.value.title,description:"Allow Manager to keep updating NAV based on the methods in the "+r.value.title+`.
 All previous manager permissions related to NAV will be revoked.`})).on("transactionHash",a=>{console.log("tx hash: "+a),i.addToast("The proposal transaction has been submitted. Please wait for it to be confirmed."),P()}).on("receipt",a=>{console.log("receipt: ",a),a.status?(P(),i.successToast("Requesting future NAV permissions transactions was successful. You can now vote on the proposal in the governance page.")):i.errorToast("The register proposal transaction has failed. Please contact the Rethink Finance support."),p.value=!1}).on("error",a=>{console.error(a),p.value=!1,i.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(a){p.value=!1,i.errorToast(a.message)}};_e(u,()=>{X()},{deep:!0});const P=async()=>{try{u.value=JSON.parse(JSON.stringify(H.value,O),we);const d=await W("navUpdateEntries");delete d[E.value],G("navUpdateEntries",d),i.successToast("Draft cleared successfully")}catch(d){console.error(d),i.errorToast("Failed to clear NAV draft")}},X=async()=>{try{const d=await W("navUpdateEntries");d[E.value]=JSON.parse(JSON.stringify(u.value,O)),G("navUpdateEntries",d)}catch(d){console.error(d),i.errorToast("Failed to save NAV draft")}};return(d,e)=>{const x=z,v=ee,h=ae;return _(),w("div",null,[s(x,null,{default:n(()=>[o("div",De,[e[8]||(e[8]=o("div",{class:"main_header__title"}," Create NAV Proposal ",-1)),o("div",Le,[e[7]||(e[7]=m(" Last NAV update date: ")),o("strong",null,F(t(Y)),1)])])]),_:1}),o("div",Ie,[s(Ue,{ref_key:"form",ref:Q,modelValue:t(k),"onUpdate:modelValue":e[6]||(e[6]=a=>$(k)?k.value=a:null)},{default:n(()=>[s(Re,{fluid:""},{default:n(()=>[s(c,null,{default:n(()=>[o("div",qe,[s(T,{class:"label_required"},{default:n(()=>e[9]||(e[9]=[m(" Proposal Title ")])),_:1}),o("div",Je,[s(v,{"char-limit":150,"char-number":t(r).title},null,8,["char-number"])])])]),_:1}),s(c,{class:"mb-6"},{default:n(()=>[s(Ce,{modelValue:t(r).title,"onUpdate:modelValue":e[0]||(e[0]=a=>t(r).title=a),placeholder:"Type here",required:""},null,8,["modelValue"])]),_:1}),s(c,null,{default:n(()=>[s(T,{class:"label_required"},{default:n(()=>e[10]||(e[10]=[m(" Management ")])),_:1})]),_:1}),s(c,{class:"mb-6"},{default:n(()=>[o("div",Oe,[o("div",$e,[o("div",We,[e[11]||(e[11]=o("div",null," Allow manager to keep updating NAV based on these methods ",-1)),s(B,{modelValue:t(r).allowManagerToUpdateNav,"onUpdate:modelValue":e[1]||(e[1]=a=>t(r).allowManagerToUpdateNav=a),color:"primary","hide-details":""},null,8,["modelValue"])]),o("div",Ge,[o("div",He,[s(ge,{color:"primary",icon:"mdi-alert-circle-outline"}),e[12]||(e[12]=o("div",null," All previous manager permissions related to NAV will be revoked. ",-1))])])]),o("div",je,[o("div",Qe,[e[13]||(e[13]=o("div",null,"Collect management fees upon NAV proposal execution",-1)),s(B,{modelValue:t(r).collectManagementFees,"onUpdate:modelValue":e[2]||(e[2]=a=>t(r).collectManagementFees=a),color:"primary","hide-details":""},null,8,["modelValue"])])]),o("div",Ye,[o("div",Ke,[e[14]||(e[14]=o("div",null,"Process withdraws after NAV update",-1)),s(B,{modelValue:t(r).processWithdraw,"onUpdate:modelValue":e[3]||(e[3]=a=>t(r).processWithdraw=a),color:"primary","hide-details":""},null,8,["modelValue"])])])])]),_:1}),s(c,null,{default:n(()=>[s(T,{class:"label_required mb-2"},{default:n(()=>e[15]||(e[15]=[m(" Proposal Description ")])),_:1})]),_:1}),s(c,{class:"mb-6"},{default:n(()=>[s(Pe,{modelValue:t(r).description,"onUpdate:modelValue":e[4]||(e[4]=a=>t(r).description=a),placeholder:"Type here","hide-details":"",required:""},null,8,["modelValue"])]),_:1}),s(c,{class:"proposal_description d-flex flex-grow-1 justify-space-between align-center mb-2"},{default:n(()=>[s(T,{class:"label_required"},{default:n(()=>e[16]||(e[16]=[m(" Proposal Methods ")])),_:1})]),_:1}),s(c,{class:"mb-4"},{default:n(()=>[s(xe,null,{default:n(()=>[s(Me,{eager:""},{default:n(()=>[s(Fe,{static:""},{default:n(()=>[o("div",Xe,[o("div",Ze,[e[17]||(e[17]=o("div",null,"â€¢",-1)),t(U)?(_(),w("div",ze,F(t(U))+" New ",1)):N("",!0),t(C)?(_(),w("div",ea,F(t(C))+" Deleted ",1)):N("",!0),!t(U)&&!t(C)?(_(),w("div",aa," 0 Changes ")):N("",!0)])])]),_:1}),s(Be,null,{default:n(()=>{var a,D,L,I,q,J;return[s(h,{methods:t(u),"onUpdate:methods":e[5]||(e[5]=Z=>$(u)?u.value=Z:null),"fund-chain-id":t(l).selectedFundChain,"fund-address":t(l).fundAddress,"fund-contract-base-token-balance":Number((a=t(l).fund)==null?void 0:a.fundContractBaseTokenBalance),"safe-contract-base-token-balance":Number((D=t(l).fund)==null?void 0:D.safeContractBaseTokenBalance),"fee-balance":Number((L=t(l).fund)==null?void 0:L.feeBalance),"safe-address":(I=t(l).fund)==null?void 0:I.safeAddress,"base-symbol":(q=t(l).fund)==null?void 0:q.baseToken.symbol,"base-decimals":(J=t(l).fund)==null?void 0:J.baseToken.decimals,"show-base-token-balances":"","show-simulated-nav":"","show-summary-row":"",deletable:"",idx:"proposal"},null,8,["methods","fund-chain-id","fund-address","fund-contract-base-token-balance","safe-contract-base-token-balance","fee-balance","safe-address","base-symbol","base-decimals"])]}),_:1})]),_:1})]),_:1})]),_:1}),s(c,null,{default:n(()=>[o("div",ta,[s(be,{class:"bg-primary text-secondary ms-6",disabled:!t(g).isConnected,onClick:K},{default:n(()=>[e[19]||(e[19]=m(" Create Proposal ")),t(g).isConnected?N("",!0):(_(),he(Se,{key:0,"model-value":!0,activator:"parent",location:"top","onUpdate:modelValue":a=>!0},{default:n(()=>e[18]||(e[18]=[m(" Connect your wallet to create a proposal. ")])),_:1}))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])}}}),La=Ne(sa,[["__scopeId","data-v-656329e8"]]);export{La as default};
