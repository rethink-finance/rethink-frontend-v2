import Ae from"./Wy3Wx6Ei.js";import Ce from"./DXxM2RMs.js";import Fe from"./DdTq_bs2.js";import ge from"./D8451dTD.js";import Ne from"./BqVuMM-N.js";import Re from"./DnDfRTIK.js";import{_ as se,l as Te,f as _,o,b as r,m as $e,d as me,u as ye,P as Pe,c9 as fe,h as d,r as F,cf as ce,a as n,c as T,cF as z,c8 as b,e as t,i as ue,p as c,w as l,V as ne,y as pe,cD as w,cZ as Ue,et as Le,da as Ee,ca as De,F as X,cB as R}from"./D3HDfnxy.js";import{u as ve,i as Ie,A as ee}from"./CL_pIM7N.js";import{b as _e,d as j,F as $,u as te,v as be}from"./DmMfJ0RA.js";import{V as ae}from"./Cg7Ey17u.js";import{_ as ze}from"./DlmOUcnW.js";import{p as Me}from"./C2Eccs3F.js";import"./C8Z2lGgf.js";import"./CJiquoOh.js";import"./BFVrtpKD.js";import"./DPhX8wWY.js";import"./cVa1OdO9.js";import"./Ce8rn2uW.js";import"./DkcdTJJR.js";const Ze={},qe={class:"d-flex align-center justify-center"};function Ge(M,i){const v=Te("Icon");return o(),_("div",qe,[r(v,{icon:"zondicons:exclamation-outline",class:"text-warning me-1",height:"1.2rem",width:"1.2rem"}),$e(M.$slots,"default")])}const Se=se(Ze,[["render",Ge]]),je={class:"transfer"},He={class:"transfer__content"},We={class:"transfer__token"},Ye={class:"transfer__token_data"},Je={class:"transfer__token_col"},Ke={class:"transfer__token_col pa-0 transfer__token_col--dark text-end"},Oe={class:"transfer__balance"},Qe={class:"buttons_container"},Xe=me({__name:"TransferBaseAsset",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(M,{emit:i}){const v=ye(),a=ve();Pe();const{isUsingZodiacPilotExtension:S}=fe(a),m=d(()=>{var s;return(s=a.fund)==null?void 0:s.baseToken}),Z=i,N=M,g=d({get:()=>(N==null?void 0:N.modelValue)??"",set:s=>{Z("update:modelValue",s)}}),P=F(!1),B=F(!1),h=d(()=>m.value?_e(g.value||"0",m.value.decimals):0n);ce(()=>g.value,()=>{P.value=!0});const p=s=>{g.value=s},x=[s=>{var V,L;let f;try{f=_e(s||"0",(V=m.value)==null?void 0:V.decimals)}catch{return`Make sure the value has max ${(L=m.value)==null?void 0:L.decimals} decimals.`}return f<=0?"Value must be positive.":f>W.value?"Not enough balance.":!0}],A=d(()=>x.map(s=>s(g.value||"0")).filter(s=>s!==!0)),H=d(()=>A.value.length>0||B.value||!S.value),q=d(()=>S.value?A.value.length&&P.value?A.value[0]:"":"Switch to the Zodiac Pilot Extension to make a transfer."),W=d(()=>{var s;return((s=a.fund)==null?void 0:s.safeContractBaseTokenBalance)||0n}),Y=d(()=>{var s;return m.value?j(W.value,(s=m.value)==null?void 0:s.decimals,!1):"--"}),oe=async()=>{B.value=!0;try{await a.fundBaseTokenContract.send("transfer",{},a==null?void 0:a.fundAddress,h.value).on("transactionHash",s=>{console.log("tx hash: ",s),v.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",s=>{console.log("receipt :",s),s.status?(v.successToast("Transfer was successful."),a.fetchFundContractBaseTokenBalance()):(v.errorToast("Your deposit request has failed. Please contact the Rethink Finance support."),a.fetchUserFundData(a.selectedFundChain,a.selectedFundAddress)),B.value=!1}).on("error",s=>{U(s)})}catch(s){U(s)}},U=s=>{B.value=!1,[4001,100].includes(s==null?void 0:s.code)?v.addToast("Transaction was rejected."):(v.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(s))};return(s,f)=>{var J,K;const V=ge,L=Se;return o(),_("div",je,[n("div",He,[f[6]||(f[6]=n("div",{class:"transfer__header"},[n("div",{class:"transfer__title"}," Transfer Base Asset to the Vault Contract "),n("div",{class:"transfer__subtitle"}," Transfer any base asset amount from the custody to the vault contract. ")],-1)),n("div",We,[n("div",Ye,[n("div",Je,b((J=t(m))==null?void 0:J.symbol),1),n("div",Ke,[r(V,{modelValue:t(g),"onUpdate:modelValue":f[0]||(f[0]=E=>ue(g)?g.value=E:null),rules:x,class:"transfer__input_amount"},null,8,["modelValue"])])]),n("div",Oe,[f[3]||(f[3]=c(" Balance: ")),n("strong",{class:"set_token_value_button mx-1",onClick:f[1]||(f[1]=E=>p(t(Y)))},b(t(Y))+" "+b((K=t(m))==null?void 0:K.symbol),1)])]),t(S)?z("",!0):(o(),T(L,{key:0,class:"switch_alert"},{default:l(()=>f[4]||(f[4]=[c(" Switch to the Zodiac Pilot extension! ")])),_:1})),n("div",Qe,[n("div",null,[r(ae,{activator:"parent",location:"bottom",disabled:!t(q)},{activator:l(({props:E})=>[r(ne,pe(E,{class:"bg-primary text-secondary",disabled:t(H),onClick:f[2]||(f[2]=ie=>oe())}),{prepend:l(()=>[t(B)?(o(),T(w,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):z("",!0)]),default:l(()=>[f[5]||(f[5]=c(" Transfer To Vault "))]),_:2},1040,["disabled"])]),default:l(()=>[c(b(t(q)),1)]),_:1},8,["disabled"])])])])])}}}),et=se(Xe,[["__scopeId","data-v-7f04e100"]]),tt={class:"transfer"},nt={class:"transfer__content"},at={class:"buttons_container"},st=me({__name:"SweepFundContract",setup(M){const i=Ue(),v=ye(),a=ve(),{isConnected:S}=fe(i),m=F(!1),Z=d(()=>!!N.value||m.value||!S.value),N=d(()=>{if(S.value){if(!g.value)return"Currently there are no base assets in the admin contract to sweep."}else return"Connect your wallet to sweep the admin contract.";return""}),g=d(()=>{var h;return((h=a.fund)==null?void 0:h.fundContractBaseTokenBalance)||0n}),P=async()=>{m.value=!0;try{const h=Le("sweepTokens()");await a.fundContract.send("fundFlowsCall",{},h).on("transactionHash",p=>{console.log("tx hash: ",p),v.addToast("The transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",p=>{console.log("receipt :",p),p.status?(v.successToast("Admin contract sweep was successful."),a.fetchFundContractBaseTokenBalance()):(v.errorToast("Your deposit request has failed. Please contact the Rethink Finance support."),a.fetchUserFundData(a.selectedFundChain,a.selectedFundAddress)),m.value=!1}).on("error",p=>{B(p)})}catch(h){B(h)}},B=h=>{[4001,100].includes(h==null?void 0:h.code)?v.addToast("Transaction was rejected."):(v.errorToast("There has been an error. Please contact the Rethink Finance support."),console.error(h)),m.value=!1};return(h,p)=>{const x=Se;return o(),_("div",tt,[n("div",nt,[p[3]||(p[3]=n("div",{class:"transfer__header"},[n("div",{class:"transfer__title"}," Transfer Base Asset to the Safe Contract "),n("div",{class:"transfer__subtitle"}," Transfer any excess base asset amount from the admin contract back to the custody contract. ")],-1)),t(S)?z("",!0):(o(),T(x,{key:0},{default:l(()=>p[1]||(p[1]=[c(" Connect your wallet to sweep the admin contract. ")])),_:1})),n("div",at,[n("div",null,[r(ae,{activator:"parent",location:"bottom",disabled:!t(S)},{activator:l(({props:A})=>[r(ne,pe(A,{class:"bg-primary text-secondary",disabled:t(Z),onClick:p[0]||(p[0]=H=>P())}),{prepend:l(()=>[t(m)?(o(),T(w,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):z("",!0)]),default:l(()=>[p[2]||(p[2]=c(" Sweep Admin Contract "))]),_:2},1040,["disabled"])]),default:l(()=>[c(b(t(N)),1)]),_:1},8,["disabled"])])])])])}}}),ot=se(st,[["__scopeId","data-v-f9bc74b4"]]),it={class:"flows"},rt={class:"main_card"},lt={class:"main_header__title"},dt={class:"tooltip__link",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},ct={class:"data_bar__item"},ut={class:"data_bar__title"},_t={class:"data_bar__item"},mt={class:"data_bar__title"},ft={class:"data_bar__item"},pt={class:"switch_to_zodiac_notification"},vt={key:1},ht={class:"main_card"},kt={class:"main_header__title"},bt={class:"tooltip__link",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},gt={class:"column-8"},Tt={class:"data_bar__item"},yt={class:"data_bar__title"},St={key:1,class:"text-error"},Vt={key:0,class:"transfer__token"},Bt={class:"transfer__token_data"},wt={class:"transfer__token_col px-4"},xt={class:"transfer__token_col transfer__input pa-0 transfer__token_col--dark text-end"},At={key:2,class:"ms-2 justify-center align-center d-flex"},Ct={class:"data_bar__subtitle d-flex"},Ft={class:"data_bar__item"},Nt={class:"data_bar__title"},Rt={key:1,class:"text-error"},$t={class:"pending_redemptions_estimate"},Pt={class:"data_bar__item"},Ut={class:"data_bar__title"},Lt={key:1,class:"text-error"},Et={class:"data_bar__item"},Dt={class:"data_bar__title"},It={key:1,class:"text-error"},zt={class:"column-4"},Mt={class:"data_bar__item"},Zt={class:"column-8"},qt={class:"data_bar__item"},Gt={class:"title_balance"},jt={key:1,class:"text-error"},Ht={class:"data_bar__item"},Wt={class:"column-4"},Yt={class:"data_bar__item"},Jt={class:"main_card main_grid"},Kt=me({__name:"index",setup(M){const i=ve(),v=Ie(),a=Ee().fund,{isUsingZodiacPilotExtension:S,totalCurrentSimulatedNAV:m,fundLastNAVUpdate:Z,fundLastNAVUpdateMethods:N}=fe(i),g=F(""),P=F(!1),B=F(""),h=F(!1);ce(()=>m.value,()=>{P.value||(g.value=j(m.value,a.baseToken.decimals,!1))},{immediate:!0});const p=[u=>{var k,y;let e;try{e=_e(u||"0",(k=i.fund)==null?void 0:k.baseToken.decimals)}catch{return`Make sure the value has max ${(y=i.fund)==null?void 0:y.baseToken.decimals} decimals.`}return e<=0?"Value must be positive.":!0}],x=F(!1),A=F(""),H=d(()=>N.value.reduce((u,e)=>u+e.isSimulatedNavError?1:0,0)),q=d(()=>H.value>0),W=d(()=>a!=null&&a.pendingDepositBalance?j(a==null?void 0:a.pendingDepositBalance,a.baseToken.decimals,!1):"0"),Y=d(()=>m.value?i.getFormattedBaseTokenValue(m.value):"0"),oe=d(()=>a!=null&&a.pendingRedemptionBalance?j(a==null?void 0:a.pendingRedemptionBalance,a.fundToken.decimals,!1):"0"),U=d(()=>{var y,G,D,Q;if(!i.fund||!((y=i.fund)!=null&&y.fundTokenTotalSupply))return;const u=$.fromString(te((G=i.fund)==null?void 0:G.fundTokenTotalSupply,(D=i.fund)==null?void 0:D.fundToken.decimals));let e;return x.value?e=g.value:e=te(m.value,(Q=i.fund)==null?void 0:Q.baseToken.decimals),$.fromString(e).div(u)}),s=d(()=>{var e,k,y;if(!i.fund||U.value===void 0)return;if(!((e=i.fund)!=null&&e.pendingRedemptionBalance))return $.fromString("0");const u=$.fromString(te((k=i.fund)==null?void 0:k.pendingRedemptionBalance,(y=i.fund)==null?void 0:y.fundToken.decimals));return console.log("actual value",u.mul(U.value)),u.mul(U.value)}),f=d(()=>{var u;return!i.fund||!s.value||s.value.isZero()?"0 "+((u=i.fund)==null?void 0:u.baseToken.symbol):(console.log("estimatedPendingRedemptionBalanceInBase",s.value),be(s.value.toString())+" "+i.fund.baseToken.symbol)}),V=d(()=>{var e,k,y;if(!i.fund||s.value===void 0)return;console.log("FF estimatedPendingRedemptionBalanceInBase",s.value);let u=$.fromString("0");return(e=i.fund)!=null&&e.fundContractBaseTokenBalance&&(u=$.fromString(te((k=i.fund)==null?void 0:k.fundContractBaseTokenBalance,(y=i.fund)==null?void 0:y.baseToken.decimals))),u.sub(s.value)}),L=d(()=>{var u;return!i.fund||V.value===void 0?"N/A":be(V.value.toString())+" "+((u=i.fund)==null?void 0:u.baseToken.symbol)}),J=d(()=>!i.fund||V.value===void 0?"":V.value.toString().replace("-","")),K=d(()=>!i.fund||V.value===void 0?"":V.value.gt($.fromValue(0))?"text-success":V.value.lt($.fromValue(0))?"text-error":""),E=u=>{A.value=u},ie=()=>{x.value=!x.value},Ve=()=>{i.simulateCurrentNAV(),i.fetchFundPendingDepositRedemptionBalance(),i.fetchFundContractBaseTokenBalance()};ce(()=>i.fundLastNAVUpdateMethods,()=>{i.simulateCurrentNAV()},{immediate:!0});const he=d(()=>v.isActionState("postUpdateNAVAction",ee.Loading)),O=d(()=>v.isActionState("fetchFundNAVDataAction",ee.Loading)),re=d(()=>v.isActionState("fetchSimulateCurrentNAVAction",ee.Loading)),le=d(()=>v.isActionState("fetchSimulatedNAVMethodValueAction",ee.Loading));return De(async()=>{h.value=!0,await Me(a.chainId,a.plannedSettlementPeriod).then(u=>{B.value=u}).catch(u=>{console.error("Error parsing planned settlement",u)}).finally(()=>{h.value=!1})}),(u,e)=>{const k=Te("Icon"),y=Ae,G=Ce,D=Fe,Q=ge,ke=Ne,Be=Re,we=et,xe=ot;return o(),_("div",it,[n("div",rt,[r(G,null,{default:l(()=>[n("div",lt,[e[9]||(e[9]=c(" Settlement Cycle ")),r(y,{location:"right","hide-after":6e3},{tooltip:l(()=>[n("a",dt,[e[8]||(e[8]=c(" Learn More ")),r(k,{icon:"maki:arrow",color:"primary",width:"1rem"})])]),default:l(()=>[r(k,{icon:"material-symbols:info-outline",class:X("main_header__info-icon"),width:"1.5rem"})]),_:1})])]),_:1}),r(D,{"bg-transparent":"",class:"settlement_cycle data_bar"},{default:l(()=>{var C;return[n("div",ct,[n("div",ut,[t(O)?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(o(),_(R,{key:1},[c(b(((C=t(Z))==null?void 0:C.date)||"N/A"),1)],64))]),e[10]||(e[10]=n("div",{class:"data_bar__subtitle"}," Last Settlement ",-1))]),n("div",_t,[n("div",mt,[t(h)?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(o(),_(R,{key:1},[c(b(t(B)),1)],64))]),e[11]||(e[11]=n("div",{class:"data_bar__subtitle"}," Planned Settlement Cycle ",-1))]),n("div",ft,[n("div",pt,[e[13]||(e[13]=n("img",{src:ze,class:"img_zodiac_pilot"},null,-1)),t(S)?(o(),_(R,{key:0},[e[12]||(e[12]=n("div",null,"Connected to the Zodiac Pilot",-1)),r(k,{icon:"octicon:check-circle-fill-16",width:"1rem",height:"1rem",color:"var(--color-success)"})],64)):(o(),_("div",vt," Switch to the Zodiac Pilot extension to complete the transfer and settle flows. "))])])]}),_:1})]),n("div",ht,[r(G,null,{default:l(()=>[n("div",kt,[e[15]||(e[15]=c(" Admin Contract ")),r(y,{location:"right","hide-after":6e3},{tooltip:l(()=>[n("a",bt,[e[14]||(e[14]=c(" Learn More ")),r(k,{icon:"maki:arrow",color:"primary",width:"1rem"})])]),default:l(()=>[r(k,{icon:"material-symbols:info-outline",class:X("main_header__info-icon"),width:"1.5rem"})]),_:1})])]),_:1}),r(D,null,{default:l(()=>{var C,de;return[n("div",gt,[n("div",Tt,[n("div",yt,[t(O)||t(le)||t(re)?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):t(a).pendingRedemptionBalanceError?(o(),_("div",St," N/A ")):(o(),_("div",{key:2,class:X(["nav_simulated_value",{"nav_simulated_value--warning":t(q)}])},[t(x)?(o(),_("div",Vt,[n("div",Bt,[n("div",wt,b((de=(C=t(i).fund)==null?void 0:C.baseToken)==null?void 0:de.symbol),1),n("div",xt,[r(Q,{modelValue:t(g),"onUpdate:modelValue":e[0]||(e[0]=I=>ue(g)?g.value=I:null),rules:p,class:"transfer__input_amount","hide-details":"",onInput:e[1]||(e[1]=I=>P.value=!0)},null,8,["modelValue"])])])])):(o(),_(R,{key:1},[c(b(t(Y)),1)],64)),t(q)?(o(),_("div",At,[r(k,{icon:"octicon:question-16",width:"1rem",color:"var(--color-warning)"}),r(ae,{activator:"parent",location:"right"},{default:l(()=>e[16]||(e[16]=[c(" Something went wrong while simulating NAV value. Retry simulating NAV. ")])),_:1})])):z("",!0)],2))]),n("div",Ct,[e[17]||(e[17]=c(" Simulated NAV ")),t(x)?(o(),T(ke,{key:1,class:"ms-2",xs:"",onClick:e[3]||(e[3]=I=>ie())},{default:l(()=>[r(k,{icon:"mdi-arrow-u-left-top",width:"1.4em",height:"1.4em"})]),_:1})):(o(),T(ke,{key:0,class:"ms-2",xs:"",onClick:e[2]||(e[2]=I=>ie())},{default:l(()=>[r(k,{icon:"fa-solid:edit",width:"1.4em",height:"1.4em"})]),_:1}))])]),n("div",Ft,[n("div",Nt,[t(a).pendingRedemptionBalanceLoading?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):t(a).pendingRedemptionBalanceError?(o(),_("div",Rt," N/A ")):(o(),_(R,{key:2},[c(b(t(oe))+" "+b(t(a).fundToken.symbol)+" ",1),n("div",$t,[e[18]||(e[18]=c(" ≈ ")),t(O)||t(le)||t(re)?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):(o(),_(R,{key:1},[c(b(t(f)),1)],64))])],64))]),e[19]||(e[19]=n("div",{class:"data_bar__subtitle"}," Redemption Requests ",-1))]),n("div",Pt,[n("div",Ut,[t(a).pendingDepositBalanceLoading?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):t(a).pendingDepositBalanceError?(o(),_("div",Lt," N/A ")):(o(),_(R,{key:2},[c(b(t(W))+" "+b(t(a).baseToken.symbol),1)],64))]),e[20]||(e[20]=n("div",{class:"data_bar__subtitle"}," Deposit Requests ",-1))]),n("div",Et,[n("div",Dt,[t(O)||t(le)||t(re)?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):t(a).pendingRedemptionBalanceError?(o(),_("div",It," N/A ")):(o(),_("div",{key:2,class:X(["funding_gap",t(K)]),onClick:e[4]||(e[4]=I=>E(t(J)))},b(t(L)),3))]),e[21]||(e[21]=n("div",{class:"data_bar__subtitle"}," Funding Gap ",-1))])]),n("div",zt,[n("div",Mt,[r(ne,{class:"text-secondary",variant:"outlined",onClick:e[5]||(e[5]=I=>Ve())},{default:l(()=>e[22]||(e[22]=[c(" Refresh Flows Info ")])),_:1})])])]}),_:1}),r(D,null,{default:l(()=>[n("div",Zt,[n("div",qt,[n("div",Gt,[t(a).fundContractBaseTokenBalanceLoading?(o(),T(w,{key:0,class:"d-flex",size:"18",width:"2",indeterminate:""})):t(a).fundContractBaseTokenBalanceError?(o(),_("div",jt," N/A ")):(o(),_(R,{key:2},[c(b(t(j)(t(a).fundContractBaseTokenBalance,t(a).baseToken.decimals,!1))+" "+b(t(a).baseToken.symbol),1)],64))]),e[23]||(e[23]=n("div",{class:"data_bar__subtitle"}," Admin Contract Balance ",-1))]),n("div",Ht,[r(Be,{class:"fund_contract_notification"},{default:l(()=>e[24]||(e[24]=[c(" Admin Contract Balance should meet Redemption Requests before being able to Settle the Flows. ")])),_:1})])]),n("div",Wt,[n("div",Yt,[r(ae,{activator:"parent",location:"bottom",disabled:t(S)},{activator:l(({props:C})=>[r(ne,pe(C,{disabled:!t(S)||t(he),class:"bg-primary text-secondary",onClick:e[6]||(e[6]=de=>t(i).postUpdateNAV())}),{prepend:l(()=>[t(he)?(o(),T(w,{key:0,class:"d-flex",size:"20",width:"3",indeterminate:""})):z("",!0)]),default:l(()=>[e[25]||(e[25]=c(" Update NAV and Settle Flows "))]),_:2},1040,["disabled"])]),default:l(()=>e[26]||(e[26]=[c(" Switch to the Zodiac Pilot Extension to Update NAV and Settle Flows. ")])),_:1},8,["disabled"])])])]),_:1})]),n("div",Jt,[r(we,{modelValue:t(A),"onUpdate:modelValue":e[7]||(e[7]=C=>ue(A)?A.value=C:null)},null,8,["modelValue"]),r(xe)])])}}}),hn=se(Kt,[["__scopeId","data-v-61fca81c"]]);export{hn as default};
