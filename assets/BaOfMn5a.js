import V from"./DNTpA6f4.js";import{f as F,_ as O}from"./CNi4G6Jr.js";import{d as C,r as T,u as J,c9 as B,ca as I,c as A,w as h,e as u,i as L,b as g,l as U,a as D,q as E,d0 as G,o as $,d1 as w,_ as j}from"./_BmmGIGi.js";import{u as N,p as q,D as p,a as o,b as H,c as K}from"./BMM55Xfq.js";import"./E_YhHG9T.js";import"./CbqMunXl.js";import"./DpsThwoF.js";import"./H7YDYKaw.js";import"./CRSZcHhx.js";import"./CVAO7RcL.js";import"./cVa1OdO9.js";import"./D_-Msn7h.js";import"./BlSCcxsD.js";import"./BJ2h6DUM.js";import"./D5-R3KnC.js";import"./B5L2f44s.js";import"./C7URMWzZ.js";import"./DcNhhkuR.js";import"./CsjIet9h.js";import"./C4hVFzQI.js";import"./DeSAm6LB.js";import"./Cx6b7hxJ.js";import"./DpICAjib.js";import"./B9vFmp28.js";import"./DAKP5pNJ.js";import"./DWhwHasW.js";import"./MPRDzB1v.js";import"./BwiW5Nlt.js";import"./CKS8D1OD.js";import"./DxTlZv4G.js";const Y={class:"tooltip__content"},z={class:"tooltip__link",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},Q=C({__name:"index",emits:["updateBreadcrumbs"],setup(W,{emit:x}){const y=x,l=T(!1),M=G(),r=N(),n=J(),{selectedFundSlug:f}=B(N()),P=[{title:"Governance",disabled:!1,to:`/details/${f.value}/governance`},{title:"Delegated Permission",disabled:!0,to:`/details/${f.value}/governance/delegated-permissions`}],b=F(q.scopeFunction),a=T([{stepName:o.Setup,stepLabel:p[o.Setup].name,formTitle:p[o.Setup].formTitle,formText:p[o.Setup].formText,stepDefaultValues:JSON.parse(JSON.stringify(b)),subStepKey:"contractMethod",multipleSteps:!0,subStepLabel:"Permission",steps:[b]},{stepName:o.Details,stepLabel:p[o.Details].name,formTitle:p[o.Details].formTitle,multipleSteps:!1,stepDefaultValues:{proposalTitle:"",proposalDescription:""},steps:[{proposalTitle:"",proposalDescription:"",transactionsOverview:"",transactionsRawJSON:""}]}]),R=s=>{a.value=s},k=async()=>{var v,S;console.log("submit",a.value);const s=(v=a.value.find(t=>t.stepName===o.Setup))==null?void 0:v.steps,e=(S=a.value.find(t=>t.stepName===o.Details))==null?void 0:S.steps[0];if(!e||!(s!=null&&s.length))return;const c=await r.fetchRoleModAddress(r.fundAddress);console.log(w(s)),console.log(w(e));const{encodedRoleModEntries:d,targets:m,gasValues:i}=K(c,s);console.log("propose:",JSON.stringify([m,i,d,JSON.stringify({title:e==null?void 0:e.proposalTitle,description:e==null?void 0:e.proposalDescription})],null,2)),l.value=!0;const _=[m,i,d,JSON.stringify({title:e==null?void 0:e.proposalTitle,description:e==null?void 0:e.proposalDescription})];try{await r.fundGovernorContract.send("propose",{},..._).on("transactionHash",t=>{console.log("tx hash: "+t),n.addToast("The proposal transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",t=>{console.log("receipt: ",t),t.status?(n.successToast("Register the proposal transactions was successful. You can now vote on the proposal in the governance page."),M.push(`/details/${f.value}/governance`)):n.errorToast("The register proposal transaction has failed. Please contact the Rethink Finance support."),l.value=!1}).on("error",t=>{console.error(t),l.value=!1,n.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(t){l.value=!1,n.errorToast(t.message)}};return I(()=>{y("updateBreadcrumbs",P)}),(s,e)=>{var i;const c=U("Icon"),d=V,m=O;return $(),A(m,{modelValue:u(a),"onUpdate:modelValue":e[0]||(e[0]=_=>L(a)?a.value=_:null),"fields-map":u(H),"chain-id":u(r).selectedFundChain,"safe-address":((i=u(r).fund)==null?void 0:i.safeAddress)??"","submit-label":"Create Proposal",class:"delegated-permission",onSubmit:k,onEntryUpdated:R},{subtitle:h(()=>[g(d,{location:"right","hide-after":6e3},{tooltip:h(()=>[D("div",Y,[D("a",z,[e[1]||(e[1]=E(" Learn More ")),g(c,{icon:"maki:arrow",color:"primary",width:"1rem"})])])]),default:h(()=>[g(c,{icon:"material-symbols:info-outline",class:"info-icon",width:"1.5rem"})]),_:1})]),_:1},8,["modelValue","fields-map","chain-id","safe-address"])}}}),Pe=j(Q,[["__scopeId","data-v-a7619fe0"]]);export{Pe as default};
