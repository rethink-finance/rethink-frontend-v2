import de from"./B2xZHB7-.js";import{d as Ve,p as ce,v as $e,r as Fe}from"./DmMfJ0RA.js";import{d as z,_ as H,f as c,o as i,b as s,g as ue,P as xe,cZ as pe,cf as Ie,h as S,c as x,d3 as Ge,w as l,cF as I,a as o,cB as L,cY as U,e as a,c8 as p,cD as Ne,l as E,p as y,F as Re,r as A,c9 as Be,ca as Le,cb as Ue,i as K,V as re}from"./D3HDfnxy.js";import Me from"./D7GFlnTX.js";import{u as ge,_ as me,P as $,a as qe,b as Oe}from"./Crw4OH5z.js";import{u as ve,i as We,A as N}from"./CL_pIM7N.js";import{V as X}from"./D3jptR6C.js";import{V as j}from"./Cg7Ey17u.js";import{a as _e}from"./CgAV7UTW.js";import je from"./C3ePeIob.js";import fe from"./Wy3Wx6Ei.js";import{t as ie}from"./BjIfPQ7A.js";import{_ as Ee}from"./B2hr6QJd.js";import ze from"./DCVy_-j1.js";import"./D-HsWzDh.js";import"./CJiquoOh.js";import"./cVa1OdO9.js";import"./Ce8rn2uW.js";import"./Dxh0CgvK.js";import"./BDLqzIVl.js";import"./DkcdTJJR.js";import"./COuEhvrh.js";import"./C8Z2lGgf.js";import"./BFVrtpKD.js";import"./DPhX8wWY.js";import"./DWe-URJs.js";import"./8pzO0o2T.js";import"./CH598blW.js";import"./LimOvMzi.js";const He=z({name:"Governance",props:{fund:{type:Object,default:()=>{}}},computed:{governanceTokenTotalSupplyFormatted(){return Ve(this.fund.governanceTokenTotalSupply,this.fund.governanceToken.decimals)+" "+this.fund.governanceToken.symbol},quorumFormatted(){return`${this.fund.quorumPercentage} (${this.fund.quorumVotesFormatted} ${this.fund.governanceToken.symbol})`}}}),Qe={class:"main_grid accordion_content"};function Ye(e,v,G,d,b,D){var _;const u=de;return i(),c("div",Qe,[s(u,{title:e.fund.governorAddress,subtitle:"Governance Contract"},null,8,["title"]),s(u,{title:(_=e.fund.governanceToken)==null?void 0:_.address,subtitle:"Governance Token"},null,8,["title"]),s(u,{title:e.fund.votingDelay,subtitle:"Voting Delay"},null,8,["title"]),s(u,{title:e.fund.votingPeriod,subtitle:"Voting Period"},null,8,["title"]),s(u,{title:e.fund.proposalThreshold,subtitle:"Proposal Threshold"},null,8,["title"]),s(u,{title:e.quorumFormatted,subtitle:"Quorum"},null,8,["title"]),s(u,{title:e.fund.lateQuorum,subtitle:"Late Quorum"},null,8,["title"]),s(u,{title:e.governanceTokenTotalSupplyFormatted,subtitle:"Governance Token Total Supply"},null,8,["title"])])}const Ze=H(He,[["render",Ye],["__scopeId","data-v-84c65c72"]]),Je={class:"table_governance__header_cell justify-end"},Ke={class:"d-flex align-center ms-1"},Xe={class:"table_governance__header_cell justify-end"},et={class:"d-flex align-center ms-1"},tt=["onClick"],ot={class:"proposal__title"},nt={class:"proposal__title__text"},at={class:"proposal__tags"},st={key:0},lt={class:"table_governance__voted_cell"},rt={key:0},it={key:1},dt={key:2},ct={class:"d-flex justify-end"},ut={class:"d-flex justify-end"},pt={key:0},gt={key:0},mt={key:1,class:"table_governance__no_data"},vt=z({__name:"ProposalsTable",props:{items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},loadingVariant:{type:String,default:"append"}},setup(e){const v=ue(),G=xe(),d=ve(),b=ge(),D=pe(),u=e,_=g=>{const m=b.hasAccountVoted(g==null?void 0:g.proposalId)??!1;return["v-data-table__row",{"row-active":g.state===$.Active&&!m||g.state===$.Pending}]};Ie([()=>u.items,()=>d.activeAccountAddress],()=>{var P,w;if(d.activeAccountAddress===void 0)return;const g=d.activeAccountAddress,m=d.selectedFundChain;for(const T of u.items)(P=b.connectedAccountProposalsHasVoted)[w=T.proposalId]??(P[w]={}),!b.connectedAccountProposalsHasVoted[T.proposalId][g]&&(T.hasVotedLoading=!0,G.callWithRetry(m,()=>d.fundGovernorContract.methods.hasVoted(T.proposalId,g).call()).then(r=>{b.connectedAccountProposalsHasVoted[T.proposalId][g]=r}).finally(()=>{T.hasVotedLoading=!1}))},{immediate:!0});const h=S(()=>{const g=[{title:"#",key:"index",sortable:!1},{title:"Proposal Title",key:"title",sortable:!0},{title:"Created",key:"createdDatetime",sortable:!0}];return D.isConnected&&g.push({title:"Voted",key:"submission_status",sortable:!0,align:"center"}),g.push({title:"Approval",key:"approval",sortable:!0},{title:"Participation",key:"participation",sortable:!0}),g}),k=(g,m)=>{const{createdBlockNumber:P,proposalId:w}=m;v.push(`governance/proposal/${P}-${w}`)};return(g,m)=>{const P=E("Icon"),w=me,T=E("icon");return e.items.length||e.loading?(i(),x(_e,{key:0,class:"table_governance",headers:a(h),hover:"",items:e.items,loading:e.loading&&e.items.length===0,"loading-text":"Loading Activity","items-per-page":"-1"},Ge({"header.approval":l(({column:r})=>[o("div",Je,[y(p(r.title)+" ",1),o("span",Ke,[s(P,{icon:"octicon:question-16",width:"1rem"})]),s(j,{activator:"parent",location:"top"},{default:l(()=>m[0]||(m[0]=[y(" Calculated as: "),o("br",null,null,-1),o("strong",null,"votes for / total casted votes",-1),o("br",null,null,-1)])),_:1})])]),"header.participation":l(({column:r})=>[o("div",Xe,[y(p(r.title)+" ",1),o("span",et,[s(P,{icon:"octicon:question-16",width:"1rem"})]),s(j,{activator:"parent",location:"top"},{default:l(()=>m[1]||(m[1]=[y(" Calculated as: "),o("br",null,null,-1),o("strong",null,"total votes / total supply",-1)])),_:1})])]),item:l(({item:r,index:Q})=>[o("tr",{class:Re(_(r)),onClick:F=>k(F,r)},[o("td",null,[o("strong",null,p(Q+1),1)]),o("td",null,[o("div",ot,[o("div",nt,[o("div",null,p(r.title),1)]),o("div",at,[s(w,{value:r.state,class:"proposal__tag"},null,8,["value"]),(i(!0),c(L,null,U(r.calldataTags??[],(F,Y)=>(i(),x(w,{key:Y,value:F,class:"proposal__tag"},null,8,["value"]))),128))])])]),o("td",null,p(r.createdDatetimeFormatted),1),a(D).isConnected?(i(),c("td",st,[o("div",lt,[r.hasVotedLoading?(i(),c("div",rt,[s(Ne,{indeterminate:"",color:"gray",size:"16",width:"2"})])):a(b).hasAccountVoted(r.proposalId)===void 0?(i(),c("div",it," N/A ")):(i(),c("div",dt,[a(b).hasAccountVoted(r.proposalId)?(i(),x(P,{key:0,icon:"weui:done-filled",width:"1rem",height:"1rem",color:"var(--color-success)"})):(i(),x(T,{key:1,icon:"mingcute:close-fill",color:"var(--color-error)"}))]))])])):I("",!0),o("td",null,[o("div",ct,[y(p(r.approvalFormatted)+" ",1),s(j,{activator:"parent",location:"bottom"},{default:l(()=>[y(p(r.forVotesFormatted)+" of "+p(r.totalVotesFormatted),1)]),_:2},1024)])]),o("td",null,[o("div",ut,[y(p(r.participationFormatted)+" ",1),s(j,{activator:"parent",location:"bottom"},{default:l(()=>[y(p(r.totalVotesFormatted)+" of "+p(r.totalSupplyFormatted),1)]),_:2},1024)])])],10,tt)]),bottom:l(()=>[]),_:2},[e.loadingVariant==="prepend"?{name:"body.prepend",fn:l(()=>[e.items.length&&e.loading?(i(),c("tr",pt,[m[2]||(m[2]=o("td",null,"1",-1)),(i(!0),c(L,null,U(a(h).length-1,r=>(i(),c("td",{key:r},[s(X,{type:"text",class:"table_governance__skeleton_loader"})]))),128))])):I("",!0)]),key:"0"}:void 0,e.loadingVariant==="append"?{name:"body.append",fn:l(()=>[e.items.length&&e.loading?(i(),c("tr",gt,[o("td",null,p(e.items.length+1),1),(i(!0),c(L,null,U(a(h).length-1,r=>(i(),c("td",{key:r},[s(X,{type:"text",class:"table_governance__skeleton_loader"})]))),128))])):I("",!0)]),key:"1"}:void 0]),1032,["headers","items","loading"])):(i(),c("div",mt," No Governance Activity details available. "))}}}),_t=H(vt,[["__scopeId","data-v-75baeaa1"]]),ft=z({name:"TableTrengingDelegates",props:{items:{type:Array,default:()=>[]},activeAccountAddress:{type:String,default:""},loading:{type:Boolean,default:!1}},data:()=>({headers:A([{title:"Delegated Members",key:"delegatedMember",sorable:!1},{title:"Delegators",key:"delegators",align:"center",sortable:!0},{title:"Impact",key:"impact",sortable:!0,align:"end"},{title:"Voting Power",key:"votingPower",sortable:!0,align:"end",value:e=>$e(e.votingPower)}])}),methods:{truncateAddress:ie,pluralizeWord:ce,copyText(e){navigator.clipboard.writeText(e)},handleRowClick(e){this.$emit("row-click",e)},parsedDelegatingToAddress(e){var v;return(e==null?void 0:e.toLowerCase())===((v=this.activeAccountAddress)==null?void 0:v.toLowerCase())?"Myself":ie(e)}}}),ht={class:"data-cell__title"},yt={class:"data-cell__text"},bt=["onClick"],kt={key:0},Pt={key:1,class:"nav_entries__no_data"};function Ct(e,v,G,d,b,D){const u=E("Icon"),_=fe;return e.items.length||e.loading?(i(),x(_e,{key:0,class:"table-trending-delegates main_table",headers:e.headers,items:e.items,loading:e.loading&&e.items.length===0,"loading-text":"Loading Trending Delegates","items-per-page":"-1"},{"item.delegatedMember":l(({item:h})=>[o("div",ht,[o("div",yt,p(e.parsedDelegatingToAddress(h.delegatedMember)),1),s(_,{location:"right"},{tooltip:l(()=>v[0]||(v[0]=[o("div",{class:"tooltip__content"},[o("span",null,"Copied")],-1)])),default:l(()=>[s(u,{icon:"clarity:copy-line",class:"copy-icon",width:"1rem",onClick:k=>e.copyText(h.delegatedMember)},null,8,["onClick"])]),_:2},1024)])]),"item.delegators":l(({item:h})=>[o("div",{class:"data-cell__delegators",onClick:k=>e.handleRowClick(h)},p(("pluralizeWord"in e?e.pluralizeWord:a(ce))("member",h.delegators.length)),9,bt)]),"body.append":l(()=>[e.items.length&&e.loading?(i(),c("tr",kt,[(i(!0),c(L,null,U(e.headers,h=>(i(),c("td",null,[s(X,{type:"text"})]))),256))])):I("",!0)]),bottom:l(()=>v[1]||(v[1]=[])),_:2},1032,["headers","items","loading"])):e.items.length===0&&!e.loading?(i(),c("div",Pt," No trending delegates found ")):I("",!0)}const St=H(ft,[["render",Ct],["__scopeId","data-v-851cbf49"]]),Tt={class:"page-governance"},At={class:"tools_all-activity-btn_subtext"},Dt={class:"tools__success-rate"},wt={class:"tools__val"},Vt={class:"mb-10"},$t=z({__name:"index",setup(e){const v=ue(),G=pe(),d=ve(),b=We(),D=ge(),u=A(!1),_=A([]),{shouldUserDelegate:h}=Be(d),k=S(()=>{const n=D.getProposals(d.selectedFundChain,d.fundAddress);return console.log("fetched proposals in view",d.selectedFundChain,d.fundAddress,n),_.value=n.filter(t=>{var f;return((f=t.calldataTags)==null?void 0:f.some(V=>V===qe.FUND_SETTINGS))&&(t.state===$.Active||t.state===$.Pending||t.state===$.Queued)}),n.sort((t,f)=>{const V=t.createdTimestamp;return f.createdTimestamp-V}),n}),g=S(()=>k.value.length===1?"1 Proposal":k.value.length+" Proposals"),m=S(()=>k.value.filter(n=>n.state===$.Pending)),P=S(()=>m.value.length===1?"1 Pending Proposal":m.value.length+" Pending Proposals"),w=S(()=>_.value.length>0),T=S(()=>{const n=k.value.filter(V=>[$.Succeeded,$.Executed].includes(V.state)),t=k.value.length-m.value.length;let f=0;return t&&(f=n.length/(k.value.length-m.value.length)),Fe(f,!1)}),r=A(!1),Q=A(!0),F=S(()=>{const n=D.getDelegates(d.selectedFundChain,d.fundAddress);return n.sort((t,f)=>{var W,B;const V=Number(t.votingPower.replace(((W=d.fund)==null?void 0:W.governanceToken.symbol)||"",""));return Number(f.votingPower.replace(((B=d.fund)==null?void 0:B.governanceToken.symbol)||"",""))-V}),Oe(n)}),Y=S(()=>F.value.length===1?"1 Delegated Wallet":F.value.length+" Delegated Wallets"),he=n=>{M.value=n,R.value=!0},R=A(!1),M=A(null),q={"Direct Execution":{click:()=>{v.push(`/details/${d.selectedFundSlug}/governance/direct-execution`)}},"Delegated Permissions":{click:()=>{v.push(`/details/${d.selectedFundSlug}/governance/delegated-permissions`)}},"NAV Methods":{click:()=>{v.push(`/details/${d.selectedFundSlug}/nav/manage`)}},"Vault Settings":{click:()=>{if(w.value){u.value=!0;return}ee()}}},ee=()=>{v.push(`/details/${d.selectedFundSlug}/governance/fund-settings`),u.value=!1},ye=()=>{const{createdBlockNumber:n,proposalId:t}=_.value[0];if(!n||!t){console.error("No proposalId or createdBlockNumber found");return}v.push(`/details/${d.selectedFundSlug}/governance/proposal/${n}-${t}`)},be=Object.keys(q).map(n=>{var t;return{label:n,disabled:((t=q[n])==null?void 0:t.disabled)||!1}}),ke=n=>{q[n]?q[n].click():console.error("Option not found")};A(!1);const te=A("append"),O=A(!1),Pe=()=>{console.log("openDelegateDialog"),O.value=!0};Le(async()=>{await Promise.all([D.fetchGovernanceProposals(),D.fetchDelegates()])}),Ue(()=>{console.log("Component is being unmounted, stopping the fetch"),r.value=!1,Q.value=!1});const Ce=async()=>{await new Promise(n=>setTimeout(n,2e3))},oe=S(()=>{const n=b.getActionState("fetchGovernanceProposalsAction");if(!n)return!1;const t=n.includes(N.Loading),f=!n.includes(N.Success)&&!n.includes(N.Error);return t||f}),Se=S(()=>{const n=b.getActionState("fetchDelegatesAction");if(!n)return!1;const t=n.includes(N.Loading),f=!n.includes(N.Success)&&!n.includes(N.Error);return t||f});return(n,t)=>{const f=Ze,V=de,Z=Me,W=E("Icon"),B=_t,ne=je,Te=fe,Ae=St,De=Ee,we=me,ae=ze;return i(),c("div",Tt,[s(V,{title:"Governance Settings",class:"data_row_card"},{body:l(()=>[s(f,{fund:a(d).fund},null,8,["fund"])]),_:1}),s(ne,{title:"Governance Activity",subtitle:a(P)},{"header-right":l(()=>[s(Z,{options:a(be),label:"Create Proposal","onUpdate:selected":ke},null,8,["options"])]),tools:l(()=>[s(re,{class:"tools__all-activity-btn text-secondary",variant:"outlined"},{default:l(()=>[t[6]||(t[6]=o("div",null,"All Activity",-1)),o("div",At," ("+p(a(g))+") ",1),s(W,{icon:"mdi:filter-variant",width:"1rem"})]),_:1}),o("div",Dt,[o("div",wt,p(a(T)),1),t[7]||(t[7]=o("div",{class:"tools__subtext"}," Success Rate ",-1))])]),default:l(()=>[s(B,{items:a(k),loading:a(oe),"loading-variant":a(te)},null,8,["items","loading","loading-variant"])]),_:1},8,["subtitle"]),s(ne,{title:"Trending Delegates",subtitle:a(Y)},{"header-right":l(()=>[s(Te,{"hide-after":6e3,"show-tooltip":!a(G).isConnected},{tooltip:l(()=>t[8]||(t[8]=[y(" Connect your wallet to delegate your votes ")])),default:l(()=>[s(re,{class:"manage_button",variant:"outlined",onClick:t[0]||(t[0]=C=>a(G).isConnected?Pe():null)},{default:l(()=>[y(p(a(h)?"Assign Delegation":"Manage Delegation"),1)]),_:1})]),_:1},8,["show-tooltip"])]),default:l(()=>[s(Ae,{items:a(F),"active-account-address":a(d).activeAccountAddress,loading:a(Se),onRowClick:he},null,8,["items","active-account-address","loading"])]),_:1},8,["subtitle"]),s(De,{modelValue:a(O),"onUpdate:modelValue":t[1]||(t[1]=C=>K(O)?O.value=C:null),onDelegateSuccess:Ce},null,8,["modelValue"]),s(ae,{modelValue:a(R),"onUpdate:modelValue":t[2]||(t[2]=C=>K(R)?R.value=C:null),title:"Delegators","confirm-text":"","cancel-text":"Close",class:"confirm_dialog","max-width":"800px",onCancel:t[3]||(t[3]=C=>R.value=!1)},{default:l(()=>{var C,se;return[o("div",Vt,[t[9]||(t[9]=o("div",{class:"title"}," Delegated Member: ",-1)),y(" "+p((C=a(M))==null?void 0:C.delegatedMember),1)]),o("div",null,[t[10]||(t[10]=o("div",{class:"title"}," Delegators: ",-1)),o("ul",null,[(i(!0),c(L,null,U((se=a(M))==null?void 0:se.delegators,J=>{var le;return i(),c("li",{key:J,class:"delegator-item"},[y(p(J)+" ",1),((le=a(M))==null?void 0:le.delegatedMember)===J?(i(),x(we,{key:0,value:"Self Delegated"})):I("",!0)])}),128))])])]}),_:1},8,["modelValue"]),s(ae,{modelValue:a(u),"onUpdate:modelValue":t[4]||(t[4]=C=>K(u)?u.value=C:null),title:"Heads Up!","confirm-text":"Create a New Proposal","cancel-text":a(_).length>1?"Cancel":"Go to existing proposal",class:"confirm_dialog","max-width":a(_).length>1?"unset":"600px",onConfirm:ee,onCancel:t[5]||(t[5]=C=>a(_).length>1?null:ye())},{default:l(()=>[t[11]||(t[11]=o("div",{class:"mb-2"}," There is already an active vault settings proposal. Are you sure you want to create a new one? ",-1)),a(_).length>1?(i(),x(B,{key:0,items:a(_),loading:a(oe),"loading-variant":a(te),style:{"margin-top":"2rem"}},null,8,["items","loading","loading-variant"])):I("",!0)]),_:1},8,["modelValue","cancel-text","max-width"])])}}}),lo=H($t,[["__scopeId","data-v-c1837193"]]);export{lo as default};
