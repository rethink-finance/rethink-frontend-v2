import W from"./DNTpA6f4.js";import G from"./CbqMunXl.js";import{d as J,r as b,P as $,u as H,c9 as U,ca as Z,f as X,b as T,w as _,e as D,l as Y,a as S,q as j,d0 as z,o as K,d1 as w,Z as C,dy as Q,_ as ee}from"./_BmmGIGi.js";import{I as r}from"./cVa1OdO9.js";import{f as o}from"./CKS8D1OD.js";import{u as te,G as oe}from"./BMM55Xfq.js";import"./E_YhHG9T.js";import"./DpsThwoF.js";import"./H7YDYKaw.js";import"./CRSZcHhx.js";import"./CVAO7RcL.js";import"./D_-Msn7h.js";import"./BlSCcxsD.js";import"./BJ2h6DUM.js";import"./D5-R3KnC.js";import"./B5L2f44s.js";import"./C7URMWzZ.js";import"./DcNhhkuR.js";import"./CsjIet9h.js";import"./C4hVFzQI.js";import"./DeSAm6LB.js";import"./Cx6b7hxJ.js";import"./DpICAjib.js";import"./B9vFmp28.js";import"./BwiW5Nlt.js";import"./DxTlZv4G.js";var s=(m=>(m.Setup="setup",m.Details="details",m))(s||{});const d={setup:{name:"Execution Setup",formTitle:"Set up Executionâ€™ Actions",formText:"<strong>CALL DATA</strong><p>The data for the function arguments you wish to send when the action executes</p>",key:"setup"},details:{name:"Proposal Details",formTitle:"Provide Proposal Information",key:"details"}},se={setup:[{label:"Raw TX Data",key:"rawTxData",type:r.Textarea,placeholder:"E.g. 0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",rules:[o.isValidHexString,o.required]},{label:"Gas To Send With Transaction",key:"gasToSendWithTransaction",type:r.Number,placeholder:"E.g. 0",min:0,rules:[o.required,o.isNonNegativeNumber]},{label:"Address of Contract Interaction",key:"addressOfContractInteraction",type:r.Text,placeholder:"E.g. 0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",rules:[o.isValidAddress,o.required]},{label:"Operation",key:"operation",type:r.Text,placeholder:"uint8",rules:[o.required]}],details:[{label:"Proposal Title",key:"proposalTitle",type:r.Text,placeholder:"E.g. Proposal Title",charLimit:150,rules:[o.required,o.charLimit(150)]},{label:"Proposal Description",key:"proposalDescription",type:r.Textarea,placeholder:"E.g. Proposal Description",rules:[o.required]}]},ae={class:"direct_execution"},re={class:"tooltip__content"},ne={class:"tooltip__link",href:"https://docs.rethink.finance/rethink.finance",target:"_blank"},ie=J({__name:"index",emits:["updateBreadcrumbs"],setup(m,{emit:I}){const P=I,n=b(!1),A=z(),i=te(),N=$(),l=H(),{selectedFundSlug:h}=U(i),F=[{title:"Governance",disabled:!1,to:`/details/${h.value}/governance`},{title:"Direct Execution",disabled:!0,to:`/details/${h.value}/governance/dirext-execution`}],x=b([{stepName:s.Setup,stepLabel:d[s.Setup].name,formTitle:d[s.Setup].formTitle,formText:d[s.Setup].formText,stepDefaultValues:{rawTxData:"",gasToSendWithTransaction:"",addressOfContractInteraction:"",operation:""},multipleSteps:!0,subStepLabel:"Execution",steps:[{rawTxData:"",gasToSendWithTransaction:"",addressOfContractInteraction:"",operation:""}]},{stepName:s.Details,stepLabel:d[s.Details].name,formTitle:d[s.Details].formTitle,multipleSteps:!1,stepDefaultValues:{proposalTitle:"",proposalDescription:""},steps:[{proposalTitle:"",proposalDescription:""}]}]),O=b(se),L=async()=>{var y,v,E,k;const a=(y=x.value.find(t=>t.stepName===s.Setup))==null?void 0:y.steps,e=(v=x.value.find(t=>t.stepName===s.Details))==null?void 0:v.steps[0];if(!e||!(a!=null&&a.length))return;console.log(w(a)),console.log(w(e));const f=N.safeMultiSendCallOnlyToAddress(i.selectedFundChain);console.log("to address: ",f);const p=[],c=[],g=[],B=oe.abi[29],V="0x000000000000000000000000"+((E=i.fund)==null?void 0:E.governorAddress.slice(2))+"000000000000000000000000000000000000000000000000000000000000000001";for(const t in a){const u=a[t];console.log("tx:",t,u);const R=[u.addressOfContractInteraction,0,u.rawTxData,parseInt(u.operation),parseInt(u.gasToSendWithTransaction),0,0,C,C,V],M=Q(B,R);p.push(M),c.push((k=i.fund)==null?void 0:k.safeAddress),g.push(0)}console.log("propose:",JSON.stringify([c,g,p,JSON.stringify({title:e==null?void 0:e.proposalTitle,description:e==null?void 0:e.proposalDescription})],null,2)),n.value=!0;const q=[c,g,p,JSON.stringify({title:e==null?void 0:e.proposalTitle,description:e==null?void 0:e.proposalDescription})];try{await i.fundGovernorContract.send("propose",{},...q).on("transactionHash",t=>{console.log("tx hash: "+t),l.addToast("The proposal transaction has been submitted. Please wait for it to be confirmed.")}).on("receipt",t=>{console.log("receipt: ",t),t.status?(l.successToast("The proposal transactions was successful. You can now vote on the proposal in the governance page."),A.push(`/details/${h.value}/governance`)):l.errorToast("The proposal transaction has failed. Please contact the Rethink Finance support."),n.value=!1}).on("error",t=>{console.error(t),n.value=!1,l.errorToast("There has been an error. Please contact the Rethink Finance support.")})}catch(t){n.value=!1,l.errorToast(t.message)}};return Z(()=>{P("updateBreadcrumbs",F)}),(a,e)=>{const f=Y("Icon"),p=W,c=G;return K(),X("div",ae,[T(c,{entry:D(x),"fields-map":D(O),title:"Direct Execution Proposal","submit-label":"Create Proposal","tooltip-text":"Create a Direct Execution Proposal","submit-event":L,"is-submit-loading":D(n)},{subtitle:_(()=>[T(p,{location:"right","hide-after":6e3},{tooltip:_(()=>[S("div",re,[e[1]||(e[1]=S("span",null,"Create a Direct Execution Proposal",-1)),S("a",ne,[e[0]||(e[0]=j(" Learn More ")),T(f,{icon:"maki:arrow",color:"primary",width:"1rem"})])])]),default:_(()=>[T(f,{icon:"material-symbols:info-outline",class:"info-icon",width:"1.5rem"})]),_:1})]),_:1},8,["entry","fields-map","is-submit-loading"])])}}}),Oe=ee(ie,[["__scopeId","data-v-38b0a0ba"]]);export{Oe as default};
